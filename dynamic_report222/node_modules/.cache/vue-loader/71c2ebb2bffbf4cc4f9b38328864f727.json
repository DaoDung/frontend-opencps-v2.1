{"remainingRequest":"/Users/binhthgc/Documents/fds/github/frontend-opencps-v2.1/dynamic_report/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/binhthgc/Documents/fds/github/frontend-opencps-v2.1/dynamic_report/src/components/form_xu_ly/TaoTaiLieuKetQua.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/binhthgc/Documents/fds/github/frontend-opencps-v2.1/dynamic_report/src/components/form_xu_ly/TaoTaiLieuKetQua.vue","mtime":1548065607214},{"path":"/Users/binhthgc/Documents/fds/github/frontend-opencps-v2.1/dynamic_report/node_modules/vuetify-loader/lib/loader.js","mtime":499162500000},{"path":"/Users/binhthgc/Documents/fds/github/frontend-opencps-v2.1/dynamic_report/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/binhthgc/Documents/fds/github/frontend-opencps-v2.1/dynamic_report/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n// import $ from 'jquery'\nimport toastr from 'toastr'\ntoastr.options = {\n  'closeButton': true,\n  'timeOut': '5000'\n}\nexport default {\n  props: {\n    id: {\n      type: String,\n      default: () => 'nm'\n    },\n    detailDossier: {\n      type: Object,\n      default: () => {}\n    },\n    createFiles: {\n      type: Array,\n      default: () => []\n    }\n  },\n  data: () => ({\n    dossierTemplateItems: [],\n    dossierMarksItems: [],\n    dossierFilesItems: [],\n    thongTinHoSo: {},\n    valid: true,\n    stateView: false,\n    dialogAddOtherTemp: false,\n    loadingAddOther: false,\n    otherDossierTemplate: '',\n    sheet: false,\n    partView: '',\n    dossierFileIdView: '',\n    stateEdit: false,\n    progressUploadPart: '',\n    dialogPDF: false,\n    dialogPDFLoading: true,\n    stateAddFileOther: false,\n    dossierTemplatesItemSelect: {},\n    fileViews: [],\n    sampleCount: 0,\n    fileTemplateItems: [],\n    currentFormView: '',\n    pstFixed: 0,\n    pstEl: 0,\n    endEl: 0\n  }),\n  computed: {\n    loading () {\n      return this.$store.getters.loading\n    },\n    originality () {\n      var vm = this\n      return vm.getOriginality()\n    },\n    initDataResource () {\n      return this.$store.getters.loadingInitData\n    }\n  },\n  created () {\n    var vm = this\n    vm.page = 1\n    vm.$nextTick(function () {\n      // console.log('vm.detailDossier------------', vm.detailDossier)\n      if (vm.detailDossier['dossierId']) {\n        var arrTemp = []\n        arrTemp.push(vm.$store.dispatch('loadDossierFiles', vm.detailDossier.dossierId))\n        arrTemp.push(vm.$store.dispatch('loadDossierTemplates', vm.detailDossier))\n        Promise.all(arrTemp).then(values => {\n          var dossierTemplates = values[1]\n          var dossierFiles = values[0]\n          vm.dossierFilesItems = dossierFiles\n          vm.createFiles = vm.mergeDossierTemplateVsDossierFiles(vm.createFiles, dossierFiles)\n          if (dossierTemplates.length !== 0) {\n            vm.createFiles.forEach(template => {\n              var itemFind = dossierTemplates.find(part => {\n                return template.partNo === part.partNo\n              })\n              if (itemFind) {\n                template['partTip'] = itemFind['partTip']\n              }\n            })\n          }\n          console.log('creataaaaaa', vm.createFiles)\n        })\n\n        // vm.$store.dispatch('loadDossierFiles', vm.detailDossier.dossierId).then(resFiles => {\n        //   vm.dossierFilesItems = resFiles\n        //   vm.createFiles = vm.mergeDossierTemplateVsDossierFiles(vm.createFiles, resFiles)\n        // }).catch(reject => {\n        // })\n      }\n    })\n  },\n  mounted () {\n    var vm = this\n    vm.$nextTick(function () {\n      if (vm.createFiles.length > 0) {\n        setTimeout(function () {\n          // console.log('vm.createFiles------------', vm.createFiles)\n          // console.log('vm.dossierFilesItems------------', vm.dossierFilesItems)\n          vm.genAllAlpacaForm(vm.dossierFilesItems, vm.createFiles)\n        }, 300)\n      }\n    })\n  },\n  methods: {\n    genAllAlpacaForm (dossierFiles, createFiles) {\n      var vm = this\n      if (dossierFiles.length > 0) {\n        var dossierFilesEform = dossierFiles.filter(file => {\n          return file.eForm\n        })\n        var dossierTemplatesHasForm = createFiles.filter(template => {\n          return template.eForm\n        })\n        if (dossierFilesEform.length > 0) {\n          dossierFilesEform.forEach(itemFiles => {\n            if (itemFiles.eForm) {\n              vm.$store.dispatch('loadAlpcaForm', itemFiles)\n            }\n          })\n        } else {\n          createFiles.forEach(val => {\n            if (val.eForm) {\n              val['templateFileNo'] = vm.detailDossier.dossierTemplateNo\n              vm.showAlpacaJSFORM(val)\n            }\n          })\n        }\n        if (dossierTemplatesHasForm.length !== dossierFilesEform.length) {\n          dossierTemplatesHasForm.forEach(template => {\n            let indexFromFile = dossierFilesEform.findIndex(item => {\n              return template.partNo === item.dossierPartNo\n            })\n            if (indexFromFile === -1) {\n              template['templateFileNo'] = vm.detailDossier.dossierTemplateNo\n              vm.showAlpacaJSFORM(template)\n            }\n          })\n        }\n      } else {\n        createFiles.forEach(val => {\n          if (val.eForm) {\n            val['templateFileNo'] = vm.detailDossier.dossierTemplateNo\n            vm.showAlpacaJSFORM(val)\n          }\n        })\n      }\n    },\n    mergeDossierTemplateVsDossierFiles (createFiles, dossierFiles) {\n      var vm = this\n      if (dossierFiles.length !== 0) {\n        createFiles.forEach(template => {\n          var itemFind = dossierFiles.find(file => {\n            return template.partNo === file.dossierPartNo && file.eForm\n          })\n          if (itemFind) {\n            template['daKhai'] = true\n          } else if (!itemFind && template.eForm) {\n            template['daKhai'] = false\n          }\n        })\n      } else {\n        createFiles.forEach(template => {\n          if (template.eForm) {\n            template['daKhai'] = false\n          }\n        })\n      }\n      return createFiles\n    },\n    showAlpacaJSFORM (item) {\n      var vm = this\n      item['dossierId'] = vm.detailDossier.dossierId\n      vm.$store.dispatch('loadFormScript', item).then(resScript => {\n        vm.$store.dispatch('loadFormData', item).then(resData => {\n          window.$('#formAlpaca' + item.partNo + vm.id).empty()\n          var formScript, formData\n          /* eslint-disable */\n          if (resScript) {\n            formScript = eval('(' + resScript + ')')\n          } else {\n            formScript = {}\n          }\n          if (resData) {\n            formData = eval('(' + resData + ')')\n          } else {\n            formData = {}\n          }\n          /* eslint-disable */\n          formScript.data = formData\n          window.$('#formAlpaca' + item.partNo + vm.id).alpaca(formScript)\n        })\n      })\n    },\n    saveAlpacaForm (item, index) {\n      var vm = this\n      console.log('itemSave', item)\n      var fileFind = vm.dossierFilesItems.find(itemFile => {\n        return itemFile.dossierPartNo === item.partNo && itemFile.eForm\n      })\n      if (fileFind) {\n        fileFind['dossierId'] = vm.detailDossier.dossierId\n        fileFind['id'] = vm.id\n        vm.$store.dispatch('putAlpacaForm', fileFind).then(resData => {\n          vm.$store.dispatch('loadDossierFiles', vm.detailDossier.dossierId).then(resFiles => {\n            vm.dossierFilesItems = resFiles\n          }).catch(reject => {\n          })\n        }).catch(reject => {\n          console.log('run saveForm')\n          toastr.error('Yêu cầu của bạn được thực hiện thất bại.')\n        })\n      } else {\n        item['dossierId'] = vm.detailDossier.dossierId\n        item['id'] = vm.id\n        vm.$store.dispatch('postEform', item).then(resPostEform => {\n          vm.createFiles[index].daKhai = true\n          vm.$store.dispatch('loadDossierFiles', vm.detailDossier.dossierId).then(resFiles => {\n            vm.dossierFilesItems = resFiles\n          }).catch(reject => {\n            toastr.error('Yêu cầu của bạn được thực hiện thất bại.')\n          })\n        }).catch(reject => {\n          toastr.error('Yêu cầu của bạn được thực hiện thất bại.')\n        })\n      }\n    },\n    onDeleteAttackFiles (item) {\n      var vm = this\n      console.log('delete')\n      let x = confirm('Bạn có muốn xóa toàn bộ file trong thành phần hồ sơ này?')\n      if (x) {\n        vm.dossierFilesItems.forEach(val => {\n          if (val.dossierPartNo === item.partNo) {\n            val['dossierId'] = vm.detailDossier.dossierId\n            vm.$store.dispatch('deleteAttackFiles', val).then(function (result) {\n              vm.$store.dispatch('loadDossierFiles', vm.detailDossier.dossierId)\n            }).catch(function (xhr) {\n            })\n          }\n        })\n      }\n    },\n    pickFile (item) {\n      var vm = this\n      vm.stateAddFileOther = false\n      document.getElementById('file' + item.partNo).value = ''\n      document.getElementById('file' + item.partNo).click()\n    },\n    onUploadSingleFile (e, data) {\n      var vm = this\n      vm.dossierTemplatesItemSelect = data\n      vm.progressUploadPart = data.partNo\n      data['dossierId'] = vm.detailDossier.dossierId\n      data['dossierTemplateNo'] = vm.detailDossier.dossierTemplateNo\n      vm.$store.dispatch('uploadSingleFile', data).then(function (result) {\n        vm.progressUploadPart = ''\n        vm.$store.dispatch('loadDossierFiles', vm.detailDossier.dossierId).then(result => {\n          vm.dossierFilesItems = result\n        })\n      }).catch(function (xhr) {\n        vm.progressUploadPart = ''\n      })\n    },\n    loadAlpcaForm (data) {\n      var vm = this\n      //\n      vm.currentFormView = 'formAlpaca' + data.partNo + vm.id\n      vm.pstEl = vm.endEl = 0\n      setTimeout(function () {\n        if ($('#formAlpaca' + data.partNo + vm.id).height() > 200) {\n          vm.pstEl = $('#wrapForm' + data.partNo + vm.id).offset().top\n          vm.endEl = $('#formAlpaca' + data.partNo + vm.id).height()\n          $(window).scroll(function () {\n            vm.pstFixed = $(window).scrollTop()\n          })\n        }\n      }, 500)\n      //\n      var fileFind = vm.dossierFilesItems.find(itemFile => {\n        return itemFile.dossierPartNo === data.partNo && itemFile.eForm\n      })\n      if (fileFind) {\n        fileFind['id'] = vm.id\n        vm.$store.dispatch('loadAlpcaForm', fileFind)\n      } else {\n        vm.createFiles.forEach(val => {\n          if (val.eForm && data.partNo === val.partNo) {\n            val['templateFileNo'] = vm.detailDossier.dossierTemplateNo\n            vm.showAlpacaJSFORM(val)\n          }\n        })\n      }\n    },\n    deleteSingleFileEform (item, index) {\n      var vm = this\n      let x = confirm('Bạn có muốn xóa?')\n      if (x) {\n        vm.dossierFilesItems.forEach(file => {\n          if (file.dossierPartNo === item.partNo && file.eForm) {\n            file['dossierId'] = vm.detailDossier.dossierId\n            vm.$store.dispatch('deleteDossierFile', file).then(resFile => {\n              console.log('success!')\n              vm.$store.dispatch('loadDossierFiles', vm.detailDossier.dossierId).then(result => {\n                vm.dossierFilesItems = result\n                var fileViewsTemp = vm.dossierFilesItems.filter(file => {\n                  return file.dossierPartNo === item.partNo && !file.eForm\n                })\n                if (fileViewsTemp) {\n                  vm.fileViews = fileViewsTemp\n                }\n                // var changeCreateFile = {\n                //   createFiles: []\n                // }\n                // if (vm.dossierFilesItems && vm.dossierFilesItems.length > 0) {\n                //   for (var i = 0; i < vm.dossierFilesItems.length; i++) {\n                //     if (vm.dossierFilesItems[i].dossierPartType === 2 && vm.dossierFilesItems[i].eForm === true) {\n                //       changeCreateFile.createFiles.push(vm.dossierFilesItems[i])\n                //     }\n                //   }\n                // }\n                // vm.$store.commit('setDataCreateFile', changeCreateFile)\n              })\n            })\n          }\n        })\n        vm.createFiles[index].daKhai = false\n      }\n    },\n    previewFileEfom (item, index) {\n      var vm = this\n      vm.dossierFilesItems.forEach(file => {\n        if (file.dossierPartNo === item.partNo && file.eForm) {\n          file['dossierId'] = vm.detailDossier.dossierId\n          vm.dialogPDFLoading = true\n          vm.dialogPDF = true\n          file['id'] = vm.id\n          vm.$store.dispatch('putAlpacaForm', file).then(resData => {\n            setTimeout(function () {\n              vm.$store.dispatch('viewFile', file).then(result => {\n                vm.dialogPDFLoading = false\n                document.getElementById('dialogPDFPreview' + vm.id).src = result\n              })\n            }, 1000)\n          }).catch(reject => {\n            toastr.error('Yêu cầu của bạn được thực hiện thất bại.')\n          })\n        }\n      })\n    },\n    deleteSingleFile (item, index) {\n      var vm = this\n      let x = confirm('Bạn có muốn xóa?')\n      if (x) {\n        item['dossierId'] = vm.detailDossier.dossierId\n        vm.$store.dispatch('deleteDossierFile', item).then(resFile => {\n          vm.fileViews.splice(index, 1)\n          vm.partView = item.dossierPartNo\n          vm.$store.dispatch('loadDossierFiles', vm.detailDossier.dossierId).then(result => {\n            vm.dossierFilesItems = result\n          })\n        }).catch(reject => {\n          toastr.error('Yêu cầu của bạn được thực hiện thất bại.')\n        })\n      }\n    },\n    viewFile (data) {\n      var vm = this\n      vm.dossierFilesItems.forEach(val => {\n        val['dossierId'] = vm.detailDossier.dossierId\n        if (val.dossierPartNo === data.partNo) {\n          this.$store.dispatch('viewFile', val)\n        }\n      })\n    },\n    viewFile2 (data) {\n      var vm = this\n      if (data.fileType === 'doc' || data.fileType === 'docx' || data.fileType === 'xlsx' || data.fileType === 'xls' || data.fileType === 'zip' || data.fileType === 'rar' || data.fileType === 'txt') {\n        var url = vm.initDataResource.dossierApi + '/' + vm.detailDossier.dossierId + '/files/' + data.referenceUid\n        window.open(url)\n      } else {\n        vm.dialogPDFLoading = true\n        vm.dialogPDF = true\n        data['dossierId'] = vm.detailDossier.dossierId\n        vm.$store.dispatch('viewFile', data).then(result => {\n          vm.dialogPDFLoading = false\n          document.getElementById('dialogPDFPreview' + vm.id).src = result\n        })\n      }\n    },\n    viewFileWithPartNo (item) {\n      var vm = this\n      if (vm.dossierFilesItems) {\n        var fileViewsTemp = vm.dossierFilesItems.filter(file => {\n          return file.dossierPartNo === item.partNo && !file.eForm\n        })\n        if (fileViewsTemp) {\n          vm.fileViews = fileViewsTemp\n          if (vm.partView !== item.partNo) {\n            vm.stateView = true\n            vm.partView = item.partNo\n          } else {\n            vm.stateView = !vm.stateView\n            vm.partView = item.partNo\n          }\n        } else {\n          return\n        }\n      }\n      return\n    },\n    checkStyle (item) {\n      return 'calc(100% - ' + 50 + 'px)'\n    },\n    downloadFileTemplate (item, index) {\n      var vm = this\n      if (vm.fileTemplateItems.length > 0) {\n        let fileFind = vm.fileTemplateItems.find(file => {\n          return item.fileTemplateNo === file.fileTemplateNo\n        })\n        if (fileFind) {\n          let url = vm.initDataResource.serviceInfoApi + '/' + fileFind.serviceCode + '/filetemplates/' + fileFind.fileTemplateNo\n          window.open(url)\n        } else {\n          console.log('ko thay file')\n        }\n      }\n    },\n    cancelDialog () {\n      var vm = this\n      vm.dialogAddOtherTemp = false\n      vm.progressUploadPart = ''\n    },\n    addFileOther (item) {\n      var vm = this\n      vm.dialogAddOtherTemp = true\n      vm.stateAddFileOther = true\n      vm.dossierTemplatesItemSelect = item\n    },\n    changeDisplayName (item, index) {\n      var vm = this\n      let params = {\n        dossierId: vm.detailDossier.dossierId,\n        value: value\n      }\n      vm.$store.dispatch('changeDisplayNameFile', params).then(result => {\n        vm.fileViews[index].displayName = result.displayName\n        vm.stateEdit = false\n      }).catch(reject => {\n        console.log('error')\n      })\n    },\n    validCreateFileTemplate () {\n      var vm = this\n      if (vm.createFiles.length > 0) {\n        for (var i = 0; i < vm.createFiles.length; i++) {\n          if (vm.createFiles[i]['required'] && !vm.createFiles[i]['daKhai']) {\n            let message = 'Chú ý :' + vm.createFiles[i].partName + ' là thành phần bắt buộc!'\n            toastr.error(message)\n            return false\n          }\n        }\n        return true\n      } else {\n        return true\n      }\n    }\n  }\n}\n",{"version":3,"sources":["TaoTaiLieuKetQua.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"TaoTaiLieuKetQua.vue","sourceRoot":"src/components/form_xu_ly","sourcesContent":["<template>\n  <div class=\"taotailieuketqua\" style=\"background-color: white;width:100%\">\n    <v-expansion-panel :value=\"[true]\" class=\"expansion-pl\">\n      <v-expansion-panel-content>\n        <div slot=\"header\">\n          <div class=\"background-triangle-small\"> \n            <v-icon size=\"18\" color=\"white\">star_rate</v-icon> \n          </div> Kết quả xử lý\n        </div>\n        <v-card>\n          <div class=\"form_alpaca\" style=\"position: relative;\" v-for=\"(item, index) in createFiles\" v-bind:key=\"item.partNo + 'cr'\">\n            <v-expansion-panel :value=\"[true]\" class=\"expaned__list__data\">\n              <v-expansion-panel-content hide-actions :value=\"currentFormView === 'formAlpaca' + item.partNo + id ? true : false\">\n                <div slot=\"header\" @click=\"stateView = false\" style=\"background-color:#fff\">\n                  <div style=\"align-items: center;background: #fff; padding-left: 25px;\" :style=\"{width: checkStyle(item)}\">\n                    <div class=\"mr-2\" @click=\"loadAlpcaForm(item)\" style=\"min-width: 18px; display: flex;\">\n                      <div class=\"header__tphs\"><span class=\"text-bold\">{{index + 1}}.</span> &nbsp;</div>\n                      <div class=\"header__tphs\">\n                        {{item.partName}} <span v-if=\"item.required\" style=\"color: red\"> (*)</span>\n                        &nbsp;&nbsp;\n                        <v-tooltip top v-if=\"item.eForm && item.daKhai\">\n                          <i slot=\"activator\" style=\"color: #0d71bb; font-size: 13px;\" class=\"fa fa-file-text-o\" aria-hidden=\"true\"></i>\n                          <span>Biểu mẫu trực tuyến (Đã khai)</span>\n                        </v-tooltip>\n                        <v-tooltip top v-if=\"item.eForm && !item.daKhai\">\n                          <i slot=\"activator\" style=\"color: #0d71bb; font-size: 13px;\" class=\"fa fa-file-o\"></i>\n                          <span>Biểu mẫu trực tuyến (Chưa khai)</span>\n                        </v-tooltip>\n                        <!-- <v-tooltip top v-if=\"!item.eForm && item.hasFileTemp\">\n                          <v-badge v-on:click.stop=\"downloadFileTemplate(item, index)\">\n                            <v-icon style=\"color: #0d71bb;\" size=\"16\" color=\"primary\">save_alt</v-icon>\n                          </v-badge>\n                          <span>Download file giấy tờ</span>\n                        </v-tooltip> -->\n                      </div>\n                    </div>\n                    <div v-for=\"(itemFileView, index) in dossierFilesItems\" :key=\"index + 'cr'\" v-if=\"item.partNo + id === itemFileView.dossierPartNo + id && !itemFileView.eForm\">\n                      <div style=\"width: calc(100% - 370px);display: flex;align-items: center;background: #fff;padding-left: 25px; font-size: 12px;\">\n                        <span v-on:click.stop=\"viewFile2(itemFileView)\" class=\"ml-3\" style=\"cursor: pointer;\">\n                          <v-icon v-if=\"itemFileView.eForm\">border_color</v-icon>\n                          <v-icon v-else>attach_file</v-icon>\n                          {{itemFileView.displayName}} - \n                          <i>{{itemFileView.modifiedDate}}</i>\n                        </span>\n                        <v-btn icon ripple v-on:click.stop=\"deleteSingleFile(itemFileView, index)\" class=\"mx-0 my-0\">\n                          <v-icon style=\"color: red\">delete_outline</v-icon>\n                        </v-btn>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n                <v-card v-if=\"item.eForm\">\n                  <v-card-text style=\"background-color: rgba(244, 247, 213, 0.19);\">\n                    <v-layout wrap>\n                      <v-flex xs12 class=\"text-xs-right\">\n                        <div :id=\"'wrapForm' + item.partNo + id\" :style=\"(pstFixed > pstEl && pstFixed < endEl + pstEl) ? 'position:fixed;top:5px;z-index:101' : ''\">\n                          <v-btn color=\"primary\" @click=\"saveAlpacaForm(item, index)\" :id=\"'saveBtn' + item.partNo + item.templateFileNo\"\n                          v-if=\"item.eForm\">Lưu lại</v-btn>\n                          <v-btn color=\"primary\" @click=\"deleteSingleFileEform(item, index)\" v-if=\"item.daKhai && item.eForm\">Xóa</v-btn>\n                          <v-btn color=\"primary\" @click=\"previewFileEfom(item, index)\" v-if=\"item.daKhai && item.eForm\">In</v-btn>\n                        </div>\n                        <div :id=\"'formAlpaca' + item.partNo + id\"></div>\n                      </v-flex>\n                    </v-layout>\n                  </v-card-text>\n                </v-card>\n              </v-expansion-panel-content>\n            </v-expansion-panel>\n            <div class=\"absolute__btn group__thanh_phan pr-3 mr-1\">\n              <content-placeholders class=\"mt-1\" v-if=\"loading\">\n                <content-placeholders-text :lines=\"1\" />\n              </content-placeholders>\n              <v-layout row wrap v-else>\n                <v-flex style=\"width: 50px;\">\n                  <input\n                  type=\"file\"\n                  style=\"display: none\"\n                  :id=\"'file' + item.partNo\"\n                  @change=\"onUploadSingleFile($event,item)\"\n                  >\n                  <v-progress-circular\n                  :width=\"2\"\n                  :size=\"25\"\n                  color=\"green\"\n                  indeterminate\n                  v-if=\"progressUploadPart + id === item.partNo + id\"\n                  ></v-progress-circular>\n                  <v-tooltip top v-else-if=\"progressUploadPart + id !== item.partNo + id\">\n                    <v-btn slot=\"activator\" icon class=\"mx-0 my-0\" @click=\"pickFile(item)\">\n                      <v-badge>\n                        <v-icon size=\"16\" color=\"primary\">cloud_upload</v-icon>\n                      </v-badge>\n                    </v-btn>\n                    <span v-if=\"!item.partTip['extensions'] && !item.partTip['maxSize']\">Tải file lên</span>\n                    <span v-else>Chấp nhận tải lên các định dạng: {{item.partTip['extensions']}}. Tối đa {{item.partTip['maxSize']}} MB </span>\n                  </v-tooltip>\n                  <!-- <v-tooltip top>\n                    <v-btn slot=\"activator\" class=\"mx-0\" fab dark small color=\"primary\" @click=\"viewFileWithPartNo(item)\" style=\"height:20px;width:20px\">\n                      {{item.count}}\n                    </v-btn>\n                    <span>Xem</span>\n                  </v-tooltip> -->\n                </v-flex>\n              </v-layout>\n            </div>\n          </div>\n        </v-card>\n        <!-- <div class=\"absolute-lable\" style=\"font-size: 12px\" v-if=\"originality !== 1 && !onlyView\">\n          <span>Không chọn</span>\n          <span>Bản chính</span>\n          <span>Bản chụp</span>\n          <span>Công chứng</span>\n        </div> -->\n        <v-dialog v-model=\"dialogPDF\" max-width=\"900\" transition=\"fade-transition\" style=\"overflow: hidden;\">\n          <v-card>\n            <v-card-title class=\"headline\">File đính kèm</v-card-title>\n            <v-btn icon dark class=\"mx-0 my-0 absolute__btn_panel mr-2\" @click.native=\"dialogPDF = false\">\n              <v-icon>clear</v-icon>\n            </v-btn>\n            <div v-if=\"dialogPDFLoading\" style=\"\n            min-height: 600px;\n            text-align: center;\n            margin: auto;\n            padding: 25%;\n            \">\n              <v-progress-circular\n              :size=\"100\"\n              :width=\"1\"\n              color=\"primary\"\n              indeterminate\n              ></v-progress-circular>\n            </div>\n            <iframe v-show=\"!dialogPDFLoading\" :id=\"'dialogPDFPreview' + id\" src=\"\" type=\"application/pdf\" width=\"100%\" height=\"100%\" style=\"overflow: auto;min-height: 600px;\" frameborder=\"0\">\n            </iframe>\n          </v-card>\n        </v-dialog>\n      </v-expansion-panel-content>\n    </v-expansion-panel>\n  </div>\n</template>\n\n<script>\n  // import $ from 'jquery'\n  import toastr from 'toastr'\n  toastr.options = {\n    'closeButton': true,\n    'timeOut': '5000'\n  }\n  export default {\n    props: {\n      id: {\n        type: String,\n        default: () => 'nm'\n      },\n      detailDossier: {\n        type: Object,\n        default: () => {}\n      },\n      createFiles: {\n        type: Array,\n        default: () => []\n      }\n    },\n    data: () => ({\n      dossierTemplateItems: [],\n      dossierMarksItems: [],\n      dossierFilesItems: [],\n      thongTinHoSo: {},\n      valid: true,\n      stateView: false,\n      dialogAddOtherTemp: false,\n      loadingAddOther: false,\n      otherDossierTemplate: '',\n      sheet: false,\n      partView: '',\n      dossierFileIdView: '',\n      stateEdit: false,\n      progressUploadPart: '',\n      dialogPDF: false,\n      dialogPDFLoading: true,\n      stateAddFileOther: false,\n      dossierTemplatesItemSelect: {},\n      fileViews: [],\n      sampleCount: 0,\n      fileTemplateItems: [],\n      currentFormView: '',\n      pstFixed: 0,\n      pstEl: 0,\n      endEl: 0\n    }),\n    computed: {\n      loading () {\n        return this.$store.getters.loading\n      },\n      originality () {\n        var vm = this\n        return vm.getOriginality()\n      },\n      initDataResource () {\n        return this.$store.getters.loadingInitData\n      }\n    },\n    created () {\n      var vm = this\n      vm.page = 1\n      vm.$nextTick(function () {\n        // console.log('vm.detailDossier------------', vm.detailDossier)\n        if (vm.detailDossier['dossierId']) {\n          var arrTemp = []\n          arrTemp.push(vm.$store.dispatch('loadDossierFiles', vm.detailDossier.dossierId))\n          arrTemp.push(vm.$store.dispatch('loadDossierTemplates', vm.detailDossier))\n          Promise.all(arrTemp).then(values => {\n            var dossierTemplates = values[1]\n            var dossierFiles = values[0]\n            vm.dossierFilesItems = dossierFiles\n            vm.createFiles = vm.mergeDossierTemplateVsDossierFiles(vm.createFiles, dossierFiles)\n            if (dossierTemplates.length !== 0) {\n              vm.createFiles.forEach(template => {\n                var itemFind = dossierTemplates.find(part => {\n                  return template.partNo === part.partNo\n                })\n                if (itemFind) {\n                  template['partTip'] = itemFind['partTip']\n                }\n              })\n            }\n            console.log('creataaaaaa', vm.createFiles)\n          })\n\n          // vm.$store.dispatch('loadDossierFiles', vm.detailDossier.dossierId).then(resFiles => {\n          //   vm.dossierFilesItems = resFiles\n          //   vm.createFiles = vm.mergeDossierTemplateVsDossierFiles(vm.createFiles, resFiles)\n          // }).catch(reject => {\n          // })\n        }\n      })\n    },\n    mounted () {\n      var vm = this\n      vm.$nextTick(function () {\n        if (vm.createFiles.length > 0) {\n          setTimeout(function () {\n            // console.log('vm.createFiles------------', vm.createFiles)\n            // console.log('vm.dossierFilesItems------------', vm.dossierFilesItems)\n            vm.genAllAlpacaForm(vm.dossierFilesItems, vm.createFiles)\n          }, 300)\n        }\n      })\n    },\n    methods: {\n      genAllAlpacaForm (dossierFiles, createFiles) {\n        var vm = this\n        if (dossierFiles.length > 0) {\n          var dossierFilesEform = dossierFiles.filter(file => {\n            return file.eForm\n          })\n          var dossierTemplatesHasForm = createFiles.filter(template => {\n            return template.eForm\n          })\n          if (dossierFilesEform.length > 0) {\n            dossierFilesEform.forEach(itemFiles => {\n              if (itemFiles.eForm) {\n                vm.$store.dispatch('loadAlpcaForm', itemFiles)\n              }\n            })\n          } else {\n            createFiles.forEach(val => {\n              if (val.eForm) {\n                val['templateFileNo'] = vm.detailDossier.dossierTemplateNo\n                vm.showAlpacaJSFORM(val)\n              }\n            })\n          }\n          if (dossierTemplatesHasForm.length !== dossierFilesEform.length) {\n            dossierTemplatesHasForm.forEach(template => {\n              let indexFromFile = dossierFilesEform.findIndex(item => {\n                return template.partNo === item.dossierPartNo\n              })\n              if (indexFromFile === -1) {\n                template['templateFileNo'] = vm.detailDossier.dossierTemplateNo\n                vm.showAlpacaJSFORM(template)\n              }\n            })\n          }\n        } else {\n          createFiles.forEach(val => {\n            if (val.eForm) {\n              val['templateFileNo'] = vm.detailDossier.dossierTemplateNo\n              vm.showAlpacaJSFORM(val)\n            }\n          })\n        }\n      },\n      mergeDossierTemplateVsDossierFiles (createFiles, dossierFiles) {\n        var vm = this\n        if (dossierFiles.length !== 0) {\n          createFiles.forEach(template => {\n            var itemFind = dossierFiles.find(file => {\n              return template.partNo === file.dossierPartNo && file.eForm\n            })\n            if (itemFind) {\n              template['daKhai'] = true\n            } else if (!itemFind && template.eForm) {\n              template['daKhai'] = false\n            }\n          })\n        } else {\n          createFiles.forEach(template => {\n            if (template.eForm) {\n              template['daKhai'] = false\n            }\n          })\n        }\n        return createFiles\n      },\n      showAlpacaJSFORM (item) {\n        var vm = this\n        item['dossierId'] = vm.detailDossier.dossierId\n        vm.$store.dispatch('loadFormScript', item).then(resScript => {\n          vm.$store.dispatch('loadFormData', item).then(resData => {\n            window.$('#formAlpaca' + item.partNo + vm.id).empty()\n            var formScript, formData\n            /* eslint-disable */\n            if (resScript) {\n              formScript = eval('(' + resScript + ')')\n            } else {\n              formScript = {}\n            }\n            if (resData) {\n              formData = eval('(' + resData + ')')\n            } else {\n              formData = {}\n            }\n            /* eslint-disable */\n            formScript.data = formData\n            window.$('#formAlpaca' + item.partNo + vm.id).alpaca(formScript)\n          })\n        })\n      },\n      saveAlpacaForm (item, index) {\n        var vm = this\n        console.log('itemSave', item)\n        var fileFind = vm.dossierFilesItems.find(itemFile => {\n          return itemFile.dossierPartNo === item.partNo && itemFile.eForm\n        })\n        if (fileFind) {\n          fileFind['dossierId'] = vm.detailDossier.dossierId\n          fileFind['id'] = vm.id\n          vm.$store.dispatch('putAlpacaForm', fileFind).then(resData => {\n            vm.$store.dispatch('loadDossierFiles', vm.detailDossier.dossierId).then(resFiles => {\n              vm.dossierFilesItems = resFiles\n            }).catch(reject => {\n            })\n          }).catch(reject => {\n            console.log('run saveForm')\n            toastr.error('Yêu cầu của bạn được thực hiện thất bại.')\n          })\n        } else {\n          item['dossierId'] = vm.detailDossier.dossierId\n          item['id'] = vm.id\n          vm.$store.dispatch('postEform', item).then(resPostEform => {\n            vm.createFiles[index].daKhai = true\n            vm.$store.dispatch('loadDossierFiles', vm.detailDossier.dossierId).then(resFiles => {\n              vm.dossierFilesItems = resFiles\n            }).catch(reject => {\n              toastr.error('Yêu cầu của bạn được thực hiện thất bại.')\n            })\n          }).catch(reject => {\n            toastr.error('Yêu cầu của bạn được thực hiện thất bại.')\n          })\n        }\n      },\n      onDeleteAttackFiles (item) {\n        var vm = this\n        console.log('delete')\n        let x = confirm('Bạn có muốn xóa toàn bộ file trong thành phần hồ sơ này?')\n        if (x) {\n          vm.dossierFilesItems.forEach(val => {\n            if (val.dossierPartNo === item.partNo) {\n              val['dossierId'] = vm.detailDossier.dossierId\n              vm.$store.dispatch('deleteAttackFiles', val).then(function (result) {\n                vm.$store.dispatch('loadDossierFiles', vm.detailDossier.dossierId)\n              }).catch(function (xhr) {\n              })\n            }\n          })\n        }\n      },\n      pickFile (item) {\n        var vm = this\n        vm.stateAddFileOther = false\n        document.getElementById('file' + item.partNo).value = ''\n        document.getElementById('file' + item.partNo).click()\n      },\n      onUploadSingleFile (e, data) {\n        var vm = this\n        vm.dossierTemplatesItemSelect = data\n        vm.progressUploadPart = data.partNo\n        data['dossierId'] = vm.detailDossier.dossierId\n        data['dossierTemplateNo'] = vm.detailDossier.dossierTemplateNo\n        vm.$store.dispatch('uploadSingleFile', data).then(function (result) {\n          vm.progressUploadPart = ''\n          vm.$store.dispatch('loadDossierFiles', vm.detailDossier.dossierId).then(result => {\n            vm.dossierFilesItems = result\n          })\n        }).catch(function (xhr) {\n          vm.progressUploadPart = ''\n        })\n      },\n      loadAlpcaForm (data) {\n        var vm = this\n        //\n        vm.currentFormView = 'formAlpaca' + data.partNo + vm.id\n        vm.pstEl = vm.endEl = 0\n        setTimeout(function () {\n          if ($('#formAlpaca' + data.partNo + vm.id).height() > 200) {\n            vm.pstEl = $('#wrapForm' + data.partNo + vm.id).offset().top\n            vm.endEl = $('#formAlpaca' + data.partNo + vm.id).height()\n            $(window).scroll(function () {\n              vm.pstFixed = $(window).scrollTop()\n            })\n          }\n        }, 500)\n        //\n        var fileFind = vm.dossierFilesItems.find(itemFile => {\n          return itemFile.dossierPartNo === data.partNo && itemFile.eForm\n        })\n        if (fileFind) {\n          fileFind['id'] = vm.id\n          vm.$store.dispatch('loadAlpcaForm', fileFind)\n        } else {\n          vm.createFiles.forEach(val => {\n            if (val.eForm && data.partNo === val.partNo) {\n              val['templateFileNo'] = vm.detailDossier.dossierTemplateNo\n              vm.showAlpacaJSFORM(val)\n            }\n          })\n        }\n      },\n      deleteSingleFileEform (item, index) {\n        var vm = this\n        let x = confirm('Bạn có muốn xóa?')\n        if (x) {\n          vm.dossierFilesItems.forEach(file => {\n            if (file.dossierPartNo === item.partNo && file.eForm) {\n              file['dossierId'] = vm.detailDossier.dossierId\n              vm.$store.dispatch('deleteDossierFile', file).then(resFile => {\n                console.log('success!')\n                vm.$store.dispatch('loadDossierFiles', vm.detailDossier.dossierId).then(result => {\n                  vm.dossierFilesItems = result\n                  var fileViewsTemp = vm.dossierFilesItems.filter(file => {\n                    return file.dossierPartNo === item.partNo && !file.eForm\n                  })\n                  if (fileViewsTemp) {\n                    vm.fileViews = fileViewsTemp\n                  }\n                  // var changeCreateFile = {\n                  //   createFiles: []\n                  // }\n                  // if (vm.dossierFilesItems && vm.dossierFilesItems.length > 0) {\n                  //   for (var i = 0; i < vm.dossierFilesItems.length; i++) {\n                  //     if (vm.dossierFilesItems[i].dossierPartType === 2 && vm.dossierFilesItems[i].eForm === true) {\n                  //       changeCreateFile.createFiles.push(vm.dossierFilesItems[i])\n                  //     }\n                  //   }\n                  // }\n                  // vm.$store.commit('setDataCreateFile', changeCreateFile)\n                })\n              })\n            }\n          })\n          vm.createFiles[index].daKhai = false\n        }\n      },\n      previewFileEfom (item, index) {\n        var vm = this\n        vm.dossierFilesItems.forEach(file => {\n          if (file.dossierPartNo === item.partNo && file.eForm) {\n            file['dossierId'] = vm.detailDossier.dossierId\n            vm.dialogPDFLoading = true\n            vm.dialogPDF = true\n            file['id'] = vm.id\n            vm.$store.dispatch('putAlpacaForm', file).then(resData => {\n              setTimeout(function () {\n                vm.$store.dispatch('viewFile', file).then(result => {\n                  vm.dialogPDFLoading = false\n                  document.getElementById('dialogPDFPreview' + vm.id).src = result\n                })\n              }, 1000)\n            }).catch(reject => {\n              toastr.error('Yêu cầu của bạn được thực hiện thất bại.')\n            })\n          }\n        })\n      },\n      deleteSingleFile (item, index) {\n        var vm = this\n        let x = confirm('Bạn có muốn xóa?')\n        if (x) {\n          item['dossierId'] = vm.detailDossier.dossierId\n          vm.$store.dispatch('deleteDossierFile', item).then(resFile => {\n            vm.fileViews.splice(index, 1)\n            vm.partView = item.dossierPartNo\n            vm.$store.dispatch('loadDossierFiles', vm.detailDossier.dossierId).then(result => {\n              vm.dossierFilesItems = result\n            })\n          }).catch(reject => {\n            toastr.error('Yêu cầu của bạn được thực hiện thất bại.')\n          })\n        }\n      },\n      viewFile (data) {\n        var vm = this\n        vm.dossierFilesItems.forEach(val => {\n          val['dossierId'] = vm.detailDossier.dossierId\n          if (val.dossierPartNo === data.partNo) {\n            this.$store.dispatch('viewFile', val)\n          }\n        })\n      },\n      viewFile2 (data) {\n        var vm = this\n        if (data.fileType === 'doc' || data.fileType === 'docx' || data.fileType === 'xlsx' || data.fileType === 'xls' || data.fileType === 'zip' || data.fileType === 'rar' || data.fileType === 'txt') {\n          var url = vm.initDataResource.dossierApi + '/' + vm.detailDossier.dossierId + '/files/' + data.referenceUid\n          window.open(url)\n        } else {\n          vm.dialogPDFLoading = true\n          vm.dialogPDF = true\n          data['dossierId'] = vm.detailDossier.dossierId\n          vm.$store.dispatch('viewFile', data).then(result => {\n            vm.dialogPDFLoading = false\n            document.getElementById('dialogPDFPreview' + vm.id).src = result\n          })\n        }\n      },\n      viewFileWithPartNo (item) {\n        var vm = this\n        if (vm.dossierFilesItems) {\n          var fileViewsTemp = vm.dossierFilesItems.filter(file => {\n            return file.dossierPartNo === item.partNo && !file.eForm\n          })\n          if (fileViewsTemp) {\n            vm.fileViews = fileViewsTemp\n            if (vm.partView !== item.partNo) {\n              vm.stateView = true\n              vm.partView = item.partNo\n            } else {\n              vm.stateView = !vm.stateView\n              vm.partView = item.partNo\n            }\n          } else {\n            return\n          }\n        }\n        return\n      },\n      checkStyle (item) {\n        return 'calc(100% - ' + 50 + 'px)'\n      },\n      downloadFileTemplate (item, index) {\n        var vm = this\n        if (vm.fileTemplateItems.length > 0) {\n          let fileFind = vm.fileTemplateItems.find(file => {\n            return item.fileTemplateNo === file.fileTemplateNo\n          })\n          if (fileFind) {\n            let url = vm.initDataResource.serviceInfoApi + '/' + fileFind.serviceCode + '/filetemplates/' + fileFind.fileTemplateNo\n            window.open(url)\n          } else {\n            console.log('ko thay file')\n          }\n        }\n      },\n      cancelDialog () {\n        var vm = this\n        vm.dialogAddOtherTemp = false\n        vm.progressUploadPart = ''\n      },\n      addFileOther (item) {\n        var vm = this\n        vm.dialogAddOtherTemp = true\n        vm.stateAddFileOther = true\n        vm.dossierTemplatesItemSelect = item\n      },\n      changeDisplayName (item, index) {\n        var vm = this\n        let params = {\n          dossierId: vm.detailDossier.dossierId,\n          value: value\n        }\n        vm.$store.dispatch('changeDisplayNameFile', params).then(result => {\n          vm.fileViews[index].displayName = result.displayName\n          vm.stateEdit = false\n        }).catch(reject => {\n          console.log('error')\n        })\n      },\n      validCreateFileTemplate () {\n        var vm = this\n        if (vm.createFiles.length > 0) {\n          for (var i = 0; i < vm.createFiles.length; i++) {\n            if (vm.createFiles[i]['required'] && !vm.createFiles[i]['daKhai']) {\n              let message = 'Chú ý :' + vm.createFiles[i].partName + ' là thành phần bắt buộc!'\n              toastr.error(message)\n              return false\n            }\n          }\n          return true\n        } else {\n          return true\n        }\n      }\n    }\n  }\n</script>\n"]}]}
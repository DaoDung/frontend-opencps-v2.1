{"remainingRequest":"/Users/binhthgc/Documents/fds/github/frontend-opencps-v2.1/dynamic_report/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/binhthgc/Documents/fds/github/frontend-opencps-v2.1/dynamic_report/src/components/screens/Landing.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/binhthgc/Documents/fds/github/frontend-opencps-v2.1/dynamic_report/src/components/screens/Landing.vue","mtime":1548055809988},{"path":"/Users/binhthgc/Documents/fds/github/frontend-opencps-v2.1/dynamic_report/node_modules/vuetify-loader/lib/loader.js","mtime":499162500000},{"path":"/Users/binhthgc/Documents/fds/github/frontend-opencps-v2.1/dynamic_report/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/binhthgc/Documents/fds/github/frontend-opencps-v2.1/dynamic_report/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport VueFriendlyIframe from 'vue-friendly-iframe'\nimport pdfMake from 'pdfmake/build/pdfmake'\nimport pdfFonts from 'pdfmake/build/vfs_fonts'\npdfMake.vfs = pdfFonts.pdfMake.vfs\nimport DatetimePicker from './DatetimePicker.vue'\nimport CsvDownload from './CsvDownload.vue'\nimport { toXML } from 'jstoxml'\nconst jsonMapper = require('json-mapper-json')\nimport saveAs from 'file-saver'\n\nexport default {\n  props: ['index'],\n  components: {\n    'vue-friendly-iframe': VueFriendlyIframe,\n    DatetimePicker,\n    'vue-csv-downloader': CsvDownload\n  },\n  data: () => ({\n    doExportExcel: false,\n    showGuilds: false,\n    showPicker: true,\n    showErrorData: false,\n    showCSVDownload: false,\n    csvExport: [],\n    fields: [],\n    valid: false,\n    api: '',\n    onlines: [],\n    online: '',\n    itemsReportsConfig: [],\n    report1Def: {},\n    docDefinition: {},\n    isDVC: false,\n    isCallBack: true,\n    fromDate: null,\n    fromDateShow: false,\n    menufromDate: false,\n    fromDateFormatted: null,\n    toDate: null,\n    toDateShow: false,\n    menutoDate: false,\n    toDateMin: null,\n    toDateFormatted: null,\n    danhSachBaoCaos: [],\n    years: [],\n    year: (new Date()).getFullYear() + '',\n    months: [],\n    month: 0,\n    agencyLists: [],\n    govAgency: 0,\n    danhSachBaoCao: [],\n    pdfBlob: null,\n    isShowLoading: false,\n    isCallData: false,\n    nameReport: '',\n    showConfig: false,\n    filters: [],\n    data: {},\n    customize: false,\n    groupBy: [],\n    groupByVal: '',\n    dataReportXX: '',\n    buttons: [],\n    buttonsVal: '',\n    buttonsShow: false,\n    noHeader: true,\n    exportXML: false,\n    jsonMapperJson: {}\n  }),\n  computed: {\n    itemsReports () {\n      return this.$store.getters.itemsReports\n    },\n    reportConfigStatic () {\n      return this.$store.getters.reportConfigStatic\n    },\n    selected: {\n      // getter\n      get: function() {\n        return this.$store.getters.selected\n      },\n      // setter\n      set: function(newValue) {\n        this.$store.commit('setselected', newValue)\n      }\n    },\n    reportType: {\n      // getter\n      get: function() {\n        return this.$store.getters.reportType\n      },\n      // setter\n      set: function(newValue) {\n        this.$store.commit('setreportType', newValue)\n      }\n    },\n    groupType: {\n      // getter\n      get: function() {\n        return this.$store.getters.groupType\n      },\n      // setter\n      set: function(newValue) {\n        this.$store.commit('setgroupType', newValue)\n      }\n    }\n  },\n  created () {\n    var vm = this\n    vm.$nextTick(function () {\n      setTimeout(() => {\n        vm.showErrorData = false\n        vm.showCSVDownload = false\n        vm.agencyLists = []\n        vm.api = ''\n        vm.filters = []\n        vm.customize = false\n        vm.data = {}\n        vm.groupBy = []\n        vm.itemsReportsConfig = []\n        vm.dataReportXX = ''\n        vm.buttons = []\n        vm.buttonsVal = ''\n        vm.buttonsShow = false\n        vm.exportXML = false\n        vm.nameReport = vm.itemsReports[vm.index]['reportName']\n        if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('reportConfig')) {\n          vm.itemsReportsConfig = vm.itemsReports[vm.index]['filterConfig']['reportConfig']\n        }\n        if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('customize')) {\n          vm.customize = vm.itemsReports[vm.index]['filterConfig']['customize']\n        }\n        if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('autoHeader')) {\n          vm.noHeader = vm.itemsReports[vm.index]['filterConfig']['autoHeader']\n        }\n        if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('groupBy')) {\n          vm.groupBy = vm.itemsReports[vm.index]['filterConfig']['groupBy']\n          let defaultValGroup = vm.groupBy[0]['key']\n          for (let keyGroup in vm.groupBy) {\n            if (vm.groupBy[keyGroup]['selected']) {\n              defaultValGroup = vm.groupBy[keyGroup]['key']\n              break\n            }\n          }\n          vm.groupByVal = defaultValGroup\n        }\n        if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('groupIds')) {\n          vm.agencyLists = vm.itemsReports[vm.index]['filterConfig']['groupIds']\n          if (vm.agencyLists.length > 0) {\n            let defaultVal = vm.agencyLists[0]['value']\n            for (let key in vm.agencyLists) {\n              if (vm.agencyLists[key]['selected']) {\n                defaultVal = vm.agencyLists[key]['value']\n                break\n              }\n            }\n            vm.govAgency = defaultVal\n          }\n        }\n        if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('api')) {\n          vm.api = vm.itemsReports[vm.index]['filterConfig']['api']\n        }\n        if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('filters')) {\n          vm.filters = vm.itemsReports[vm.index]['filterConfig']['filters']\n        }\n        for (let key in vm.filters) {\n          if (vm.filters[key]['type'] === 'select' || vm.filters[key]['type'] === 'date') {\n            vm.data[vm.filters[key]['key']] = vm.filters[key]['value']\n          }\n        }\n        if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('buttons')) {\n          vm.buttons = vm.itemsReports[vm.index]['filterConfig']['buttons']\n          if (vm.buttons.length > 0) {\n            setTimeout(() => {\n              vm.buttonsShow = true\n            }, 100)\n          }\n        }\n        if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('exportXML')) {\n          vm.exportXML = vm.itemsReports[vm.index]['filterConfig']['exportXML']\n        }\n        vm.report1Def = {}\n        for (let key in vm.itemsReportsConfig) {\n          vm.report1Def[vm.itemsReportsConfig[key]['value']] = vm.itemsReportsConfig[key]['text']\n        }\n        vm.reportType = vm.itemsReports[vm.index]['document']\n        if (vm.showConfig) {\n          vm.showConfig = false\n          setTimeout(() => {\n            vm.showConfig = true\n          }, 200)\n        }\n        vm.pdfBlob = ''\n      }, 500)\n    })\n  },\n  watch: {\n    '$route': function (newRoute, oldRoute) {\n      let vm = this\n      console.debug(oldRoute)\n      vm.showErrorData = false\n      vm.showCSVDownload = false\n      vm.itemsReportsConfig = []\n      vm.groupBy = []\n      vm.customize = false\n      vm.data = {}\n      vm.api = ''\n      vm.filters = []\n      vm.report1Def = {}\n      vm.dataReportXX = ''\n      vm.buttons = []\n      vm.buttonsVal = ''\n      vm.buttonsShow = false\n      vm.exportXML = false\n      vm.nameReport = vm.itemsReports[vm.index]['reportName']\n      if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('reportConfig')) {\n        vm.itemsReportsConfig = vm.itemsReports[vm.index]['filterConfig']['reportConfig']\n      }\n      if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('customize')) {\n        vm.customize = vm.itemsReports[vm.index]['filterConfig']['customize']\n      }\n      if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('autoHeader')) {\n        vm.noHeader = vm.itemsReports[vm.index]['filterConfig']['autoHeader']\n      }\n      if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('groupBy')) {\n        vm.groupBy = vm.itemsReports[vm.index]['filterConfig']['groupBy']\n        let defaultValGroup = vm.groupBy[0]['key']\n        for (let keyGroup in vm.groupBy) {\n          if (vm.groupBy[keyGroup]['selected']) {\n            defaultValGroup = vm.groupBy[keyGroup]['key']\n            break\n          }\n        }\n        vm.groupByVal = defaultValGroup\n      }\n      if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('groupIds')) {\n        vm.agencyLists = vm.itemsReports[vm.index]['filterConfig']['groupIds']\n        if (vm.agencyLists.length > 0) {\n          let defaultVal = vm.agencyLists[0]['value']\n          for (let key in vm.agencyLists) {\n            if (vm.agencyLists[key]['selected']) {\n              defaultVal = vm.agencyLists[key]['value']\n              break\n            }\n          }\n          vm.govAgency = defaultVal\n        }\n      }\n      if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('api')) {\n        vm.api = vm.itemsReports[vm.index]['filterConfig']['api']\n      }\n      if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('filters')) {\n        vm.filters = vm.itemsReports[vm.index]['filterConfig']['filters']\n      }\n      for (let key in vm.itemsReportsConfig) {\n        vm.report1Def[vm.itemsReportsConfig[key]['value']] = vm.itemsReportsConfig[key]['text']\n      }\n      vm.reportType = vm.itemsReports[vm.index]['document']\n      vm.pdfBlob = ''\n      for (let key in vm.filters) {\n        if (vm.filters[key]['type'] === 'select' || vm.filters[key]['type'] === 'date') {\n          vm.data[vm.filters[key]['key']] = vm.filters[key]['value']\n        }\n      }\n      if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('buttons')) {\n        vm.buttons = vm.itemsReports[vm.index]['filterConfig']['buttons']\n        if (vm.buttons.length > 0) {\n          setTimeout(() => {\n            vm.buttonsShow = true\n          }, 100)\n        }\n      }\n      if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('exportXML')) {\n        vm.exportXML = vm.itemsReports[vm.index]['filterConfig']['exportXML']\n      }\n      if (vm.showConfig) {\n        vm.showConfig = false\n        setTimeout(() => {\n          vm.showConfig = true\n        }, 200)\n      }\n    }\n  },\n  methods: {\n    doCreatePDF () {\n      let vm = this\n      if (vm.reportType.startsWith('STATISTIC')) {\n        vm.doPrintReportFix()\n      } else {\n        vm.doDynamicReport()\n      }\n      vm.isCallData = true\n    },\n    doDynamicReport () {\n      let vm = this\n      vm.docDefinition = {}\n      let docDString = {}\n      vm.dataReportXX = ''\n      docDString = JSON.stringify(vm.reportConfigStatic[vm.index]['docDefinition'])\n      docDString = docDString.replace(/\\[\\$siteName\\$\\]/g, vm.$store.getters.siteName)\n      for (let key in vm.filters) {\n        let find = vm.filters[key]['key']\n        let currentVal = vm.data[vm.filters[key]['key']]\n        if (currentVal !== '' && currentVal !== undefined && currentVal !== null) {\n          let dateStr = new Date(currentVal).toLocaleDateString('vi-VN')\n          if (dateStr !== 'Invalid Date'&& String(currentVal).length === 13) {\n            docDString = docDString.replace(eval('/\\\\[\\\\$' + find + '\\\\$\\\\]/g'), dateStr)\n          } else {\n            if (vm.filters[key]['type'] === 'select') {\n              for (let keySource in vm.filters[key]['source']) {\n                if (String(vm.filters[key]['source'][keySource]['value']) === String(currentVal)) {\n                  currentVal = vm.filters[key]['source'][keySource]['name']\n                }\n              }\n            }\n            docDString = docDString.replace(eval('/\\\\[\\\\$' + find + '\\\\$\\\\]/g'), currentVal)\n          }\n        } else {\n          currentVal = ''\n          for (let keySource in vm.filters[key]['source']) {\n            if (currentVal === '' || currentVal === '0') {\n              currentVal = vm.filters[key]['source'][keySource]['name']\n              break\n            }\n          }\n          docDString = docDString.replace(eval('/\\\\[\\\\$' + find + '\\\\$\\\\]/g'), currentVal)\n        }\n      }\n      vm.agencyLists = vm.itemsReports[vm.index]['filterConfig']['groupIds']\n      for (let key in vm.agencyLists) {\n        if (String(vm.agencyLists[key]['value']) === String(vm.govAgency)) {\n          docDString = docDString.replace(/\\[\\$groupIds\\$\\]/g, vm.agencyLists[key]['text'])\n          break\n        }\n      }\n      vm.api = vm.itemsReports[vm.index]['filterConfig']['api']\n      let widthsConfig = []\n      widthsConfig.push(30)\n      let headerTableReport = '['\n      let header2TableReport = '['\n      headerTableReport += JSON.stringify({\n        text: 'STT',\n        alignment: 'center',\n        bold: true\n      }) + ','\n      header2TableReport += JSON.stringify({\n        text: '(1)',\n        alignment: 'center',\n        italics: true\n      }) + ','\n      let ine = 2\n      let colLeng = 0\n      for (let key in vm.itemsReportsConfig) {\n        if (vm.itemsReportsConfig[key].hasOwnProperty('selected') && vm.itemsReportsConfig[key]['selected']) {\n          colLeng = colLeng + 1\n          widthsConfig.push('auto')\n          // vm.docDefinition['content'][2]['table']['widths'].push('auto')\n          let str1 = ' '\n          if (vm.report1Def[vm.itemsReportsConfig[key]['value']] !== undefined && vm.report1Def[vm.itemsReportsConfig[key]['value']] !== null && vm.report1Def[vm.itemsReportsConfig[key]['value']] !== '') {\n            str1 = vm.report1Def[vm.itemsReportsConfig[key]['value']]\n          }\n          headerTableReport += JSON.stringify({\n            text: str1,\n            alignment: 'center',\n            bold: true\n          }) + ','\n          header2TableReport += JSON.stringify({\n            text: '(' + ine + ')',\n            alignment: 'center',\n            italics: true\n          }) + ','\n          ine = ine + 1\n        }\n      }\n      if (vm.noHeader) {\n        vm.dataReportXX += headerTableReport.substring(0, headerTableReport.length - 1) + '],'\n        vm.dataReportXX += header2TableReport.substring(0, header2TableReport.length - 1) + '],'\n      }\n      \n      // bild data\n      let filter = {\n        document: vm.reportType,\n        data: vm.data,\n        api: vm.api\n      }\n      filter['govAgency'] = vm.govAgency\n      filter['agencyLists'] = vm.agencyLists\n      vm.pdfBlob = null\n      vm.isShowLoading = true\n      vm.$store.dispatch('getAgencyReportLists', filter).then(function (result) {\n        if (result !== null && result !== undefined) {\n          let dataReport = result\n          let dossierRaw = {}\n          let dataReportCurrent = {}\n          let dataReportTotal = ''\n          let textGroup = ''\n          for (let keyGroup in vm.groupBy) {\n            if (String(vm.groupBy[keyGroup]['key']) === String(vm.groupByVal)) {\n              textGroup = vm.groupBy[keyGroup]['display']\n              break\n            }\n          }\n          for (let key in dataReport) {\n            dataReportCurrent = dataReport[key]\n            if (dossierRaw[dataReportCurrent[vm.groupByVal]] !== '' && dossierRaw[dataReportCurrent[vm.groupByVal]] !== undefined) {\n              if (dossierRaw[dataReportCurrent[vm.groupByVal]][textGroup] === dataReportCurrent[textGroup]) {\n                dossierRaw[dataReportCurrent[vm.groupByVal]]['dossiers'].push(dataReportCurrent)\n                dossierRaw[dataReportCurrent[vm.groupByVal]]['totalChild'] = dossierRaw[dataReportCurrent[vm.groupByVal]]['totalChild'] + 1\n              }\n            } else {\n              let dossierRawItem = {}\n              dossierRawItem[vm.groupByVal] = dataReportCurrent[vm.groupByVal]\n              dossierRawItem[textGroup] = dataReportCurrent[textGroup]\n              dossierRawItem['totalChild'] = 1\n              dossierRawItem['dossiers'] = []\n              dossierRaw[dataReportCurrent[vm.groupByVal]] = dossierRawItem\n              dossierRaw[dataReportCurrent[vm.groupByVal]][textGroup] = dataReportCurrent[textGroup]\n              dossierRaw[dataReportCurrent[vm.groupByVal]]['dossiers'].push(dataReportCurrent)\n            }\n          }\n          let dataToExportCSV = []\n          for (let key in dossierRaw) {\n            if (dossierRaw[key][vm.groupByVal] !== undefined && dossierRaw[key][vm.groupByVal] !== null && dossierRaw[key][vm.groupByVal] !== '') {\n              let csvGroup = []\n              csvGroup.push(dossierRaw[key][vm.groupByVal] + ' - ' + dossierRaw[key][textGroup] + ' ( ' + dossierRaw[key]['totalChild'] + ' ) ')\n              for (let colLengIndex in colLeng) {\n                csvGroup.push('')\n              }\n              dataToExportCSV.push(csvGroup)\n              dataReportTotal += JSON.stringify([{\n                colSpan: colLeng + 1,\n                text: dossierRaw[key][vm.groupByVal] + ' - ' + dossierRaw[key][textGroup] + ' ( ' + dossierRaw[key]['totalChild'] + ' ) ',\n                bold: true,\n                style: 'tdStyle'\n              }]) + ','\n            }\n            /*\n            vm.docDefinition['content'][2]['table']['body'].push([{\n              colSpan: val.length + 1,\n              text: '- ' + domains[0]['services'][key]['serviceCode'] + ' - ' + domains[0]['services'][key]['serviceName'],\n              bold: true,\n              style: 'tdStyle'\n            }])\n            */\n            let dossiersArray = dossierRaw[key]['dossiers']\n            let indexStt = 1\n            let dataRow = []\n            for (let keyDossier in dossiersArray) {\n              dataRow = []\n              let dataToExportCSVItem = []\n              let dossierObj = dossiersArray[keyDossier]\n              dataToExportCSVItem.push(indexStt)\n              dataRow.push({\n                text: indexStt, \n                alignment: 'center',\n                style: 'tdStyle'\n              })\n              for (let keyVal in vm.itemsReportsConfig) {\n                if (vm.itemsReportsConfig[keyVal].hasOwnProperty('selected') && vm.itemsReportsConfig[keyVal]['selected']) {\n                  let alignmentConfig = 'center'\n                  if (vm.itemsReportsConfig[keyVal].hasOwnProperty('align')) {\n                    alignmentConfig = vm.itemsReportsConfig[keyVal]['align']\n                  }\n                  let ddStr = ' '\n                  if (dossierObj[vm.itemsReportsConfig[keyVal]['value']] !== undefined && dossierObj[vm.itemsReportsConfig[keyVal]['value']] !== null && dossierObj[vm.itemsReportsConfig[keyVal]['value']] !== '') {\n                    ddStr = dossierObj[vm.itemsReportsConfig[keyVal]['value']]\n                  }\n                  dataToExportCSVItem.push(ddStr)\n                  dataRow.push({\n                    text: ddStr, \n                    alignment: alignmentConfig,\n                    style: 'tdStyle'\n                  })\n                }\n              }\n              dataReportTotal += JSON.stringify(dataRow) + ','\n              // vm.docDefinition['content'][2]['table']['body'].push(dataRow)\n              indexStt = indexStt + 1\n              dataToExportCSV.push(dataToExportCSVItem)\n            }\n          }\n          dataReportTotal = dataReportTotal.substring(0, dataReportTotal.length - 1)\n          vm.dataReportXX += dataReportTotal\n          // }\n          vm.csvExport = []\n          vm.csvExport = dataToExportCSV\n          vm.fields = []\n          vm.fields.push('STT')\n          for (let excelKey in vm.itemsReportsConfig) {\n            if (vm.itemsReportsConfig[excelKey]['selected']) {\n              let stringColumn = vm.itemsReportsConfig[excelKey]['value']\n              if (vm.itemsReportsConfig[excelKey]['text'] !== '') {\n                stringColumn = vm.itemsReportsConfig[excelKey]['text']\n              }\n              vm.fields.push(stringColumn)\n            }\n          }\n          vm.showCSVDownload = true\n          docDString = docDString.replace(/\"\\[\\$tableWidth\\$\\]\"/g, JSON.stringify(widthsConfig))\n          docDString = docDString.replace(/\"\\[\\$report\\$\\]\"/g, vm.dataReportXX)\n          vm.docDefinition = JSON.parse(docDString)\n          let pdfDocGenerator = pdfMake.createPdf(vm.docDefinition)\n          pdfDocGenerator.getBlob((blob) => {\n            vm.pdfBlob = window.URL.createObjectURL(blob)\n            vm.isShowLoading = false\n            if (vm.doExportExcel) {\n              let currentTimestemp = new Date().getTime()\n              let fileToExcel = new File([blob], currentTimestemp + '.pdf')\n              {\n                var reader = new FileReader()\n                reader.onload = function(e) {\n                    var data = e.target.result\n                    console.log('data', data)\n                    vm.convertPDFToHTML(data)\n                };\n                reader.readAsArrayBuffer(fileToExcel)\n              }\n            }\n          })\n        } else {\n          // vm.agencyLists = []\n          vm.isShowLoading = false\n          vm.showErrorData = true\n        }\n      })\n    },\n    doPrintReportFix () {\n      let vm = this\n      vm.agencyLists = []\n      vm.api = ''\n      vm.dataReportXX = ''\n      vm.docDefinition = {}\n      let docDString = {}\n      docDString = JSON.stringify(vm.reportConfigStatic[vm.index]['docDefinition'])\n      docDString = docDString.replace(/\\[\\$siteName\\$\\]/g, vm.$store.getters.siteName)\n      for (let key in vm.filters) {\n        let find = vm.filters[key]['key']\n        let currentVal = vm.data[vm.filters[key]['key']]\n        if (currentVal !== '' && currentVal !== undefined && currentVal !== null) {\n          let dateStr = new Date(currentVal).toLocaleDateString('vi-VN')\n          if (dateStr !== 'Invalid Date'&& String(currentVal).length === 13) {\n            docDString = docDString.replace(eval('/\\\\[\\\\$' + find + '\\\\$\\\\]/g'), dateStr)\n          } else {\n            if (vm.filters[key]['type'] === 'select') {\n              for (let keySource in vm.filters[key]['source']) {\n                if (String(vm.filters[key]['source'][keySource]['value']) === String(currentVal)) {\n                  currentVal = vm.filters[key]['source'][keySource]['name']\n                }\n              }\n            }\n            docDString = docDString.replace(eval('/\\\\[\\\\$' + find + '\\\\$\\\\]/g'), currentVal)\n          }\n        } else {\n          currentVal = ''\n          for (let keySource in vm.filters[key]['source']) {\n            if (currentVal === '' || currentVal === '0') {\n              currentVal = vm.filters[key]['source'][keySource]['name']\n              break\n            }\n          }\n          docDString = docDString.replace(eval('/\\\\[\\\\$' + find + '\\\\$\\\\]/g'), currentVal)\n        }\n      }\n      vm.agencyLists = vm.itemsReports[vm.index]['filterConfig']['groupIds']\n      for (let key in vm.agencyLists) {\n        if (String(vm.agencyLists[key]['value']) === String(vm.govAgency)) {\n          docDString = docDString.replace(/\\[\\$groupIds\\$\\]/g, vm.agencyLists[key]['text'])\n          break\n        }\n      }\n      vm.api = vm.itemsReports[vm.index]['filterConfig']['api']\n      vm.isShowLoading = true\n      let filter = {\n        document: vm.reportType,\n        data: vm.data,\n        api: vm.api\n      }\n      filter['govAgency'] = vm.govAgency\n      filter['agencyLists'] = vm.agencyLists\n      vm.pdfBlob = null\n      vm.isShowLoading = true\n      let sumKey = vm.itemsReports[vm.index]['filterConfig']['sumKey']\n      let selection = vm.itemsReports[vm.index]['filterConfig']['selection']\n      let merge = vm.itemsReports[vm.index]['filterConfig']['merge']\n      let sort = vm.itemsReports[vm.index]['filterConfig']['sort']\n      let subKey = vm.itemsReports[vm.index]['filterConfig']['subKey']\n      vm.$store.dispatch('getAgencyReportLists', filter).then(function (result) {\n        if (result !== null) {\n          let index = 1\n          let dataRowTotal = []\n          let totalText = 'Tổng số'\n          if (sumKey === 'month') {\n            totalText = 'Cả năm'\n          }\n          dataRowTotal.push({\n            text: totalText, \n            colSpan: 2,\n            bold: true,\n            alignment: 'center',\n            style: 'tdStyle'\n          })\n          for (let keyMapping in vm.itemsReportsConfig) {\n            if (vm.itemsReportsConfig[keyMapping]['value'] === 'note') {\n              dataRowTotal.push({\n                text: '', \n                alignment: 'center',\n                style: 'tdStyle'\n              })\n            }  else {\n              dataRowTotal.push({\n                text: 0, \n                alignment: 'center',\n                style: 'tdStyle'\n              })\n            }\n          }\n          \n          // TODO\n          let resultData = result\n          if (selection !== undefined && selection !== null && selection.length > 0) {\n            resultData = result.filter(function(obj) {\n              let totalCHK = 0\n              for (let keySe in selection) {\n                if (selection[keySe]['compare'] === '#') {\n                  if (String(obj[selection[keySe]['key']]) !== String(selection[keySe]['value'])) {\n                    totalCHK = totalCHK + 1\n                    // return obj\n                  }\n                } else if (selection[keySe]['compare'] === '=') {\n                  if (selection[keySe]['value'] === '') {\n                    if (String(obj[selection[keySe]['key']]) === '' || obj[selection[keySe]['key']] === undefined || obj[selection[keySe]['key']] === null) {\n                      totalCHK = totalCHK + 1\n                      // return obj\n                    }\n                  } else {\n                    if (String(obj[selection[keySe]['key']]) === String(selection[keySe]['value'])) {\n                      totalCHK = totalCHK + 1\n                      // return obj\n                    }\n                  }\n                } else {\n                  if (String(obj[selection[keySe]['key']]) === '' || obj[selection[keySe]['key']] === undefined || obj[selection[keySe]['key']] === null) {\n                    totalCHK = totalCHK + 1\n                    // return obj\n                  }\n                }\n              }\n              if (totalCHK === selection.length) {\n                return obj\n              }\n            })\n          }\n          let resultDataTotal = resultData.filter(function(obj) {\n            if (subKey !== null && subKey !== undefined && subKey !== '') {\n              if ((obj[sumKey] === '' || String(obj[sumKey]) === '0' || obj[sumKey] === undefined || obj[sumKey] === null) && obj[subKey] === '') {\n                return obj\n              }\n            } else {\n              if (obj[sumKey] === '' || String(obj[sumKey]) === '0' || obj[sumKey] === undefined || obj[sumKey] === null) {\n                return obj\n              }\n            }\n          })\n          let resultDataVari = {}\n          for (let key in resultData) {\n            let keyVari = ''\n            for (let keysd in merge) {\n              keyVari += resultData[key][merge[keysd]] + '_'\n            }\n            if (resultDataVari[keyVari] === undefined || resultDataVari[keyVari] === null || resultDataVari[keyVari] === '') {\n              resultDataVari[keyVari] = resultData[key]\n            } else {\n              for (let kkey in resultDataVari[keyVari]) {\n                if (resultDataVari[keyVari][kkey] !== '' && resultDataVari[keyVari][kkey] !== undefined && resultDataVari[keyVari][kkey] !== null) {\n                  if (String(parseInt(resultDataVari[keyVari][kkey])) === 'NaN') {\n                    resultDataVari[keyVari][kkey] = resultData[key][kkey]\n                  } else if (kkey === 'ontimePercentage') {\n                    resultDataVari[keyVari][kkey] = parseInt(resultData[key][kkey])\n                  } else if (kkey === 'month' || kkey === 'year') {\n                    resultDataVari[keyVari][kkey] = parseInt(resultData[key][kkey])\n                  } else {\n                    resultDataVari[keyVari][kkey] = parseInt(resultData[key][kkey]) + parseInt(resultDataVari[keyVari][kkey])\n                  }\n                }\n              }\n            }\n          }\n          resultData = []\n          for (let key in resultDataVari) {\n            if (key !== undefined && !key.startsWith('undefined')) {\n              resultData.push(resultDataVari[key])\n            }\n          }\n          if (sort !== '' && sort !== undefined && sort !== null) {\n            resultData = vm.sortByKey(resultData, sort)\n          }\n          if (subKey !== null && subKey !== undefined && subKey !== '') {\n            let arraySubKey = {}\n            for (let key in resultData) {\n              if ((resultData[key][sumKey] !== '' && String(resultData[key][sumKey]) !== '0' && resultData[key][sumKey] !== undefined && resultData[key][sumKey] !== null) ||\n                (subKey !== null && subKey !== undefined && subKey !== '' && resultData[key][subKey] === '' && resultData[key][sumKey] !== '' && resultData[key][sumKey] !== '0')) {\n                if (arraySubKey[resultData[key][sumKey]] !== undefined && arraySubKey[resultData[key][sumKey]] !== null) {\n                  arraySubKey[resultData[key][sumKey]].push(resultData[key])\n                } else {\n                  arraySubKey[resultData[key][sumKey]] = []\n                  arraySubKey[resultData[key][sumKey]].push(resultData[key])\n                }\n              }\n            }\n            resultData = []\n            for (let keySUBARRAY in arraySubKey) {\n              let subKeySortData = vm.sortByKey(arraySubKey[keySUBARRAY], subKey)\n              for (let keyData in subKeySortData) {\n                resultData.push(subKeySortData[keyData])\n              }\n            }\n          }\n          let dataToExportCSV = []\n          for (let key in resultData) {\n            let dataInput = resultData[key]\n            if ((resultData[key][sumKey] !== '' && String(resultData[key][sumKey]) !== '0' && resultData[key][sumKey] !== undefined && resultData[key][sumKey] !== null) ||\n                (subKey !== null && subKey !== undefined && subKey !== '' && resultData[key][subKey] === '' && resultData[key][sumKey] !== '' && String(resultData[key][sumKey]) !== '0')) {\n              let dataRow = []\n              let dataToExportCSVItem = []\n              if (subKey !== null && subKey !== undefined && subKey !== '' && resultData[key][subKey] !== '') {\n                dataToExportCSVItem.push('')\n                dataRow.push({\n                  text: '', \n                  alignment: 'center',\n                  style: 'tdStyle'\n                })\n              } else {\n                dataToExportCSVItem.push(index)\n                dataRow.push({\n                  text: index, \n                  alignment: 'center',\n                  style: 'tdStyle'\n                })\n              }\n              let indexTotal = 1\n              for (let keyMapping in vm.itemsReportsConfig) {\n                let currentConfig = vm.itemsReportsConfig[keyMapping]\n                let dataText = ' '\n                let preff = currentConfig.hasOwnProperty('prefix') ? currentConfig['prefix'] : ''\n                if (currentConfig.hasOwnProperty('calculator')) {\n                  dataText = Math.round(eval(currentConfig['calculator']))\n                } else {\n                  if (resultData[key][currentConfig['value']] !== undefined && resultData[key][currentConfig['value']] !== null) {\n                    if (currentConfig.hasOwnProperty('subValue') && resultData[key][subKey] !== '') {\n                      dataText =  ' - ' + resultData[key][currentConfig['subValue']] + ' '\n                    } else {\n                      dataText = preff + ' ' + resultData[key][currentConfig['value']] + ' '\n                    }\n                  }\n                }\n                let alignmentConfig = 'center'\n                if (currentConfig.hasOwnProperty('align')) {\n                  alignmentConfig = currentConfig['align']\n                }\n                dataToExportCSVItem.push(dataText)\n                dataRow.push({\n                  text: dataText, \n                  alignment: alignmentConfig,\n                  style: 'tdStyle'\n                })\n                if (vm.govAgency === 0) {\n                  if (dataRowTotal[indexTotal] !== null && dataRowTotal[indexTotal] !== undefined && dataRowTotal[indexTotal]['text'] !== '') {\n                    if (currentConfig['value'] === 'ontimePercentage') {\n                      dataRowTotal[indexTotal]['text'] = parseInt(dataText)\n                    } else if (isNaN(dataText)) {\n                      dataRowTotal[indexTotal]['text'] = ' '\n                    } else {\n                      dataRowTotal[indexTotal]['text'] = parseInt(dataRowTotal[indexTotal]['text']) + parseInt(dataText)\n                    }\n                  }\n                }\n                indexTotal = indexTotal + 1\n              }\n              if (subKey !== null && subKey !== undefined && subKey !== '' && resultData[key][subKey] !== '') {\n                \n              } else {\n                index = index + 1\n              }\n              // vm.docDefinition['content'][2]['table']['body'].push(dataRow)\n              vm.dataReportXX += JSON.stringify(dataRow) + ','\n              dataToExportCSV.push(dataToExportCSVItem)\n            }\n          }\n          if (vm.agencyLists.length > 0 && vm.govAgency === 0) {\n            /*\n            let resultDataVariTotal = {}\n            for (let key in resultDataTotal) {\n              let keyVari = ''\n              for (let keysd in merge) {\n                keyVari += resultDataTotal[key][merge[keysd]] + '_'\n              }\n              if (resultDataVariTotal[keyVari] === undefined || resultDataVariTotal[keyVari] === null || resultDataVariTotal[keyVari] === '') {\n                resultDataVariTotal[keyVari] = resultDataTotal[key]\n              } else {\n                for (let kkey in resultDataVariTotal[keyVari]) {\n                  if (resultDataVariTotal[keyVari][kkey] !== '' && resultDataVariTotal[keyVari][kkey] !== undefined && resultDataVariTotal[keyVari][kkey] !== null) {\n                    if (String(parseInt(resultDataVariTotal[keyVari][kkey])) === 'NaN') {\n                      resultDataVariTotal[keyVari][kkey] = resultDataTotal[key][kkey]\n                    } else if (kkey === 'ontimePercentage') {\n                      resultDataVariTotal[keyVari][kkey] = parseInt(resultDataVariTotal[keyVari][kkey])\n                    } else {\n                      resultDataVariTotal[keyVari][kkey] = parseInt(resultDataTotal[key][kkey]) + parseInt(resultDataVariTotal[keyVari][kkey])\n                    }\n                  }\n                }\n              }\n            }\n            resultDataTotal = []\n            for (let key in resultDataVariTotal) {\n              if (key === undefined || key === 'undefined_') {\n                resultDataTotal.push(resultDataVariTotal[key])\n              }\n            }\n            */\n            for (let keyXXTT in resultDataTotal) {\n              let indexTotalXXTT = 1\n              let dataInputXXTT = ''\n              dataInputXXTT = resultDataTotal[keyXXTT]\n              for (let keyMappingXXTT in vm.itemsReportsConfig) {\n                let dataTextXXTT = ''\n                let currentConfigXXTT = vm.itemsReportsConfig[keyMappingXXTT]\n                if (currentConfigXXTT.hasOwnProperty('calculator')) {\n                  console.log('dataInputXXTT', dataInputXXTT)\n                  dataTextXXTT = Math.round(eval(currentConfigXXTT['calculator'].replace(/dataInput/g, 'dataInputXXTT')))\n                  console.log('dataTextXXTT', dataTextXXTT)\n                } else if (resultDataTotal[keyXXTT][currentConfigXXTT['value']] !== undefined && resultDataTotal[keyXXTT][currentConfigXXTT['value']] !== null && resultDataTotal[keyXXTT][currentConfigXXTT['value']] !== '') {\n                  dataTextXXTT = resultDataTotal[keyXXTT][currentConfigXXTT['value']] + ' '\n                }\n                dataRowTotal[indexTotalXXTT]['text'] = parseInt(dataTextXXTT) + ' '\n                indexTotalXXTT = indexTotalXXTT + 1\n              }\n              break\n            }\n          } else {\n            for (let keyXXTT in resultDataTotal) {\n              let indexTotalXXTT = 1\n              let dataInputXXTT = ''\n              dataInputXXTT = resultDataTotal[keyXXTT]\n              for (let keyMappingXXTT in vm.itemsReportsConfig) {\n                let dataTextXXTT = ''\n                let currentConfigXXTT = vm.itemsReportsConfig[keyMappingXXTT]\n                if (currentConfigXXTT.hasOwnProperty('calculator')) {\n                  dataTextXXTT = Math.round(eval(currentConfigXXTT['calculator'].replace(/dataInput/g, 'dataInputXXTT')))\n                } else if (resultDataTotal[keyXXTT][currentConfigXXTT['value']] !== undefined && resultDataTotal[keyXXTT][currentConfigXXTT['value']] !== null && resultDataTotal[keyXXTT][currentConfigXXTT['value']] !== '') {\n                  dataTextXXTT = resultDataTotal[keyXXTT][currentConfigXXTT['value']] + ' '\n                }\n                dataRowTotal[indexTotalXXTT]['text'] = parseInt(dataTextXXTT) + ' '\n                indexTotalXXTT = indexTotalXXTT + 1\n              }\n            }\n          }\n          console.log('dataRowTotal: ', dataRowTotal)\n          vm.dataReportXX += JSON.stringify(dataRowTotal)\n          dataToExportCSV\n          let itemTotal = []\n          for (let keyTotalCSV in dataRowTotal) {\n            itemTotal.push(dataRowTotal[keyTotalCSV]['text'])\n          }\n          dataToExportCSV.push(itemTotal)\n          vm.csvExport = []\n          vm.csvExport = dataToExportCSV\n          vm.fields = []\n          vm.fields.push('STT')\n          vm.fields.push(sumKey)\n          for (let excelKey in vm.itemsReportsConfig) {\n            if (vm.itemsReportsConfig[excelKey]['selected']) {\n              let stringColumn = vm.itemsReportsConfig[excelKey]['value']\n              if (vm.itemsReportsConfig[excelKey]['text'] !== '') {\n                stringColumn = vm.itemsReportsConfig[excelKey]['text']\n              }\n              vm.fields.push(stringColumn)\n            }\n          }\n          vm.showCSVDownload = true\n          docDString = docDString.replace(/\"\\[\\$report\\$\\]\"/g, vm.dataReportXX)\n          // vm.docDefinition['content'][2]['table']['body'].push(dataRowTotal)\n          vm.docDefinition = JSON.parse(docDString)\n          let pdfDocGenerator = pdfMake.createPdf(vm.docDefinition)\n          pdfDocGenerator.getBlob((blob) => {\n            vm.pdfBlob = window.URL.createObjectURL(blob)\n            vm.isShowLoading = false\n            if (vm.doExportExcel) {\n              let currentTimestemp = new Date().getTime()\n              let fileToExcel = new File([blob], currentTimestemp + '.pdf')\n              {\n                var reader = new FileReader()\n                reader.onload = function(e) {\n                    var data = e.target.result\n                    console.log('data', data)\n                    vm.convertPDFToHTML(data)\n                };\n                reader.readAsArrayBuffer(fileToExcel)\n              }\n            }\n          })\n        } else {\n          // vm.agencyLists = []\n          vm.isShowLoading = false\n          vm.showErrorData = true\n        }\n      })\n    },\n    doCreateReport(isExportExcel) {\n      let vm = this\n      if (vm.$refs.form.validate()) {\n        vm.doExportExcel = isExportExcel\n        vm.showConfig = false\n        vm.doCreatePDF()\n      }\n    },\n    sortByKey (array, key) {\n      return array.sort(function(a, b) {\n        var x = a[key]; var y = b[key];\n        return ((x < y) ? -1 : ((x > y) ? 1 : 0));\n      })\n    },\n    changeConfig (index) {\n      let vm = this\n      if (vm.itemsReportsConfig[index].hasOwnProperty('selected')) {\n        if (vm.itemsReportsConfig[index]['selected']) {\n          vm.itemsReportsConfig[index]['selected'] = false\n        } else {\n          vm.itemsReportsConfig[index]['selected'] = true\n        }\n      } else {\n        vm.itemsReportsConfig[index]['selected'] = true\n      }\n    },\n    doChotSoLieu (dataSelect, button) {\n      let vm = this\n      let filter = {\n        api: button['api'],\n        key: button['key'],\n        value: dataSelect,\n        data: vm.data\n      }\n      vm.$store.dispatch('doChotSoLieu', filter).then(function () {\n        vm.doCreatePDF()\n      })\n    },\n    reloadPickerChange (key) {\n      let vm = this\n      vm.showPicker = false\n      setTimeout(() => {\n        vm.data[key] = new Date(vm.data[key]).toLocaleDateString('vi-VN')\n        vm.showPicker = true\n      }, 200)\n    },\n    sdfsdfdsf () {\n      let vm = this\n      vm.$store.dispatch('doExportXlsxddd')\n    },\n    toDoNotDone () {\n      alert('Đang phát triển.')\n    },\n    doDynamicReportXML () {\n      let vm = this\n      vm.agencyLists = vm.itemsReports[vm.index]['filterConfig']['groupIds']\n      vm.jsonMapperJson = {}\n      vm.jsonMapperJson = vm.itemsReports[vm.index]['userConfig']\n      vm.api = vm.itemsReports[vm.index]['filterConfig']['api']\n      // bild data\n      let filter = {\n        document: vm.reportType,\n        data: vm.data,\n        api: vm.api\n      }\n      filter['govAgency'] = vm.govAgency\n      filter['agencyLists'] = vm.agencyLists\n      vm.$store.dispatch('getAgencyReportLists', filter).then(function (result) {\n        if (result !== null && result !== undefined) {\n          jsonMapper({ 'content': result, 'blank': '' }, vm.jsonMapperJson).then((result) => {\n            console.log(result)\n            const xmlOptions = {\n              header: true,\n              indent: '  '\n            };\n            let xmlToExport = toXML(result, xmlOptions)\n            var blob = new Blob([ new TextEncoder().encode( xmlToExport ) ], {\n                type: \"text/plain;charset=utf-8;\",\n            })\n            saveAs(blob, new Date().getTime() + \".xml\");\n          })\n        }\n      })\n    },\n    convertPDFToHTML (content) {\n      let vm = this\n      window.PDFJS.getDocument(content).then(window.pdf_table_extractor).then(function (result) {\n        let all_tables = [];\n        let page_tables = result.pageTables.shift()\n        all_tables = all_tables.concat(page_tables.tables);\n        let table_dom = $('<table></table>').attr('border', 1);\n        let tables = page_tables.tables;\n        let merge_alias = page_tables.merge_alias;\n        let merges = page_tables.merges;\n\n        for (let r = 0; r < tables.length; r++) {\n          let tr_dom = $('<tr></tr>')\n          for (let c = 0; c < tables[r].length; c++) {\n            let r_c = [r, c].join('-')\n            if (merge_alias[r_c]) {\n              continue\n            }\n            let td_dom = $('<td></td>');\n            if (merges[r_c]) {\n              if (merges[r_c].width > 1) {\n                td_dom.attr('colspan', merges[r_c].width)\n              }\n              if (merges[r_c].height > 1) {\n                td_dom.attr('rowspan', merges[r_c].height)\n              }\n            }\n            td_dom.html(tables[r][c].replace(/\\n/ig, '<br/>').replace(/↵/ig, '<br/>'))\n            tr_dom.append(td_dom)\n          }\n          table_dom.append(tr_dom)\n        }\n         var tab_text = '<html xmlns:x=\"urn:schemas-microsoft-com:office:excel\">'\n        tab_text = tab_text + '<head><meta http-equiv=\"content-type\" content=\"text/html; charset=UTF-8\"/><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>'\n        tab_text = tab_text + '<x:Name>Test Sheet</x:Name>'\n        tab_text = tab_text + '<x:WorksheetOptions><x:Panes></x:Panes></x:WorksheetOptions></x:ExcelWorksheet>'\n        tab_text = tab_text + '</x:ExcelWorksheets></x:ExcelWorkbook></xml></head><body>'\n        \n        tab_text = tab_text + '<table></table><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tbody><tr><td colspan=\"10\" valign=\"top\" width=\"167\"><p align=\"center\"><strong>TỔNG CỤC ĐBVN (UBND TỈNH ……)</strong><br>Cục QLĐB (Sở GTVT)…..<br><strong>-------</strong></p></td><td valign=\"top\" width=\"275\" colspan=\"10\"><p align=\"center\"><strong>CỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM<br>Độc lập - Tự do - Hạnh phúc <br>---------------</strong></p></td></tr></tbody></table><table></table>';\n        tab_text = tab_text + '<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tbody><tr><td colspan=\"20\" valign=\"top\" width=\"167\"><p align=\"center\"><strong>TỔNG HỢP HỒ SƠ NỘP TRỰC TUYẾN THEO LĨNH VỰC</strong></p></td></td></tr></tbody></table><table></table>';\n\n        tab_text = tab_text + \"<table border='1px'>\"\n        tab_text = tab_text + table_dom[0].innerHTML\n        \n        tab_text = tab_text + '<table></table><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tbody><tr><td colspan=\"4\" valign=\"top\" width=\"167\"><p align=\"left\"><strong>Nơi nhận:</strong></p></td><td valign=\"top\" width=\"275\" colspan=\"16\"><p align=\"right\"><strong>THỦ TRƯỞNG ĐƠN VỊ</strong><br/>(Ký và ghi rõ họ tên)</p></td></tr></tbody></table><table></table>';\n        tab_text = tab_text + '</body></html>';\n\n        var blob = new Blob([ new TextEncoder().encode( tab_text ) ], {\n          type: 'application/octet-stream',\n        })\n        saveAs(blob, new Date().getTime() + \".xls\");\n      })\n    },\n    s2ab (s) {\n      var buf = new ArrayBuffer(s.length);\n      var view = new Uint8Array(buf);\n      for (var i=0; i!=s.length; ++i) view[i] = s.charCodeAt(i) & 0xFF;\n      return buf;\n    }\n  }\n}\n",{"version":3,"sources":["Landing.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Landing.vue","sourceRoot":"src/components/screens","sourcesContent":["<template>\n<v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n  <div class=\"form-chitiet\">\n    <div class=\"row-header\">\n      <div class=\"background-triangle-big\"> <span>{{nameReport}}</span> </div>\n      <div class=\"layout row wrap header_tools row-blue\">\n        <div class=\"flex xs12 pl-3 text-ellipsis text-bold\">\n          <v-layout wrap class=\"chart__report\">\n            <v-flex class=\"px-2 text-right\">\n              <!--\n              <v-btn flat class=\"mx-0 my-0\" v-if=\"showConfig\" v-on:click.native=\"doSaveConfig\">\n                <v-icon>settings</v-icon> &nbsp;\n                Lưu thay đổi\n              </v-btn>\n              <vue-csv-downloader\n                :data=\"csvExport\"\n                :fields=\"fields\"\n                :downloadname=\"nameReport\"\n              >\n              </vue-csv-downloader>\n              -->\n              <v-btn flat class=\"mx-0 my-0\" v-on:click.native=\"showGuilds = !showGuilds\">\n                <v-icon>receipt</v-icon> &nbsp; Hướng dẫn PDF -> Excel\n              </v-btn>\n              <v-select v-if=\"buttonsShow\"\n                v-for=\"(button, btnIndex) in buttons\" v-bind:key=\"btnIndex\"\n                :items=\"button['source']\"\n                :label=\"button['label']\"\n                v-model=\"buttonsVal\"\n                item-text=\"name\"\n                item-value=\"value\"\n                single-line\n                style=\"float: right;\"\n                class=\"btn__chot\"\n                @change=\"doChotSoLieu($event, button)\"\n              ></v-select>\n              <v-btn flat class=\"mx-0 my-0\" v-if=\"customize\" v-on:click.native=\"showConfig = !showConfig\">\n                <v-icon v-if=\"showConfig\">reply</v-icon>\n                <v-icon v-else>settings</v-icon> &nbsp;\n                <span v-if=\"showConfig\">Quay lại</span>\n                <span v-else>Tuỳ chọn</span>\n              </v-btn>\n            </v-flex>\n          </v-layout>\n        </div>\n      </div>\n    </div>\n    <v-layout row wrap class=\"filter_menu mt-4\">\n      <v-flex xs6 sm2 class=\"mx-3\" v-if=\"agencyLists.length > 1\">\n        <v-autocomplete\n          :items=\"agencyLists\"\n          v-model=\"govAgency\"\n          label=\"Chọn đơn vị\"\n          item-text=\"text\"\n          item-value=\"value\"\n          >\n        </v-autocomplete>\n      </v-flex>\n      <v-flex xs6 sm2 class=\"mx-3\" v-if=\"groupBy.length > 1\">\n        <v-autocomplete\n          :items=\"groupBy\"\n          v-model=\"groupByVal\"\n          label=\"Nhóm dữ liệu\"\n          item-text=\"label\"\n          item-value=\"key\"\n          >\n        </v-autocomplete>\n      </v-flex>\n      <v-flex xs12 sm2 class=\"mx-3\" v-for=\"(item, indexTool) in filters\" v-bind:key=\"indexTool\">\n        <datetime-picker\n          v-if=\"item['type'] === 'date' && showPicker\"\n          v-model=\"data[item.key]\" \n          :item=\"item\" \n          :data-value=\"data[item.key]\"\n          :data-all=\"data\"\n          @change=\"reloadPickerChange(item.key)\">\n        </datetime-picker>\n        <v-text-field \n          v-if=\"item['type'] === 'text'\"\n          v-model=\"data[item.key]\" \n          :label=\"item['label']\">\n        </v-text-field>\n        <v-select\n          v-if=\"item['type'] === 'select'\"\n          :items=\"item['source']\"\n          v-model=\"data[item.key]\"\n          :label=\"item['label']\"\n          item-value=\"value\"\n          item-text=\"name\"\n        ></v-select>\n      </v-flex>\n    </v-layout>\n    <v-layout align-start justify-start row wrap class=\"filter_menu my-3 px-4\" v-if=\"showConfig\">\n      <v-flex class=\"mx-2\" v-for=\"(item, index) in itemsReportsConfig\" v-bind:key=\"index\">\n        <v-checkbox v-if=\"!reportType.startsWith('STATISTIC')\" @change=\"changeConfig(index)\" v-model=\"selected\" :label=\"item.text\" :value=\"item.value\"></v-checkbox>\n      </v-flex>\n    </v-layout>\n    <v-layout row wrap>\n      <v-flex xs12>\n        <v-btn dark v-on:click.native=\"doCreateReport(false)\" color=\"blue darken-3\">Tạo báo cáo</v-btn>\n        <v-btn flat class=\"mx-0 my-0\" v-on:click.native=\"doCreateReport(true)\">\n          <v-icon>receipt</v-icon> &nbsp; Tải xuống Excel\n        </v-btn>\n        <v-btn v-if=\"exportXML\" dark v-on:click.native=\"doDynamicReportXML\" color=\"blue darken-3\">exportXML</v-btn>\n      </v-flex>\n    </v-layout>\n    <div>\n      <vue-friendly-iframe v-if=\"showGuilds\" src=\"https://vietopencps.github.io/frontend-opencps-v2.1/o/opencps-frontend/dynamic_report/assets/hdsd.pdf\"></vue-friendly-iframe>\n      <vue-friendly-iframe v-if=\"pdfBlob !== null && pdfBlob !== undefined && pdfBlob !== ''\" :src=\"pdfBlob\"></vue-friendly-iframe>\n      <div class=\"mx-2\" v-if=\"showErrorData\">\n        <v-alert :value=\"true\" outline color=\"info\" icon=\"info\">\n          Không có dữ liệu báo cáo.\n        </v-alert>\n      </div>\n      <v-layout row wrap v-if=\"isShowLoading\">\n        <v-flex xs12 class=\"text-xs-center\" mt-5>\n          <v-progress-circular\n            :size=\"100\"\n            :width=\"1\"\n            color=\"primary\"\n            indeterminate\n          ></v-progress-circular>\n        </v-flex>\n      </v-layout>\n    </div>\n  </div>\n</v-form>\n</template>\n\n<script>\nimport VueFriendlyIframe from 'vue-friendly-iframe'\nimport pdfMake from 'pdfmake/build/pdfmake'\nimport pdfFonts from 'pdfmake/build/vfs_fonts'\npdfMake.vfs = pdfFonts.pdfMake.vfs\nimport DatetimePicker from './DatetimePicker.vue'\nimport CsvDownload from './CsvDownload.vue'\nimport { toXML } from 'jstoxml'\nconst jsonMapper = require('json-mapper-json')\nimport saveAs from 'file-saver'\n\nexport default {\n  props: ['index'],\n  components: {\n    'vue-friendly-iframe': VueFriendlyIframe,\n    DatetimePicker,\n    'vue-csv-downloader': CsvDownload\n  },\n  data: () => ({\n    doExportExcel: false,\n    showGuilds: false,\n    showPicker: true,\n    showErrorData: false,\n    showCSVDownload: false,\n    csvExport: [],\n    fields: [],\n    valid: false,\n    api: '',\n    onlines: [],\n    online: '',\n    itemsReportsConfig: [],\n    report1Def: {},\n    docDefinition: {},\n    isDVC: false,\n    isCallBack: true,\n    fromDate: null,\n    fromDateShow: false,\n    menufromDate: false,\n    fromDateFormatted: null,\n    toDate: null,\n    toDateShow: false,\n    menutoDate: false,\n    toDateMin: null,\n    toDateFormatted: null,\n    danhSachBaoCaos: [],\n    years: [],\n    year: (new Date()).getFullYear() + '',\n    months: [],\n    month: 0,\n    agencyLists: [],\n    govAgency: 0,\n    danhSachBaoCao: [],\n    pdfBlob: null,\n    isShowLoading: false,\n    isCallData: false,\n    nameReport: '',\n    showConfig: false,\n    filters: [],\n    data: {},\n    customize: false,\n    groupBy: [],\n    groupByVal: '',\n    dataReportXX: '',\n    buttons: [],\n    buttonsVal: '',\n    buttonsShow: false,\n    noHeader: true,\n    exportXML: false,\n    jsonMapperJson: {}\n  }),\n  computed: {\n    itemsReports () {\n      return this.$store.getters.itemsReports\n    },\n    reportConfigStatic () {\n      return this.$store.getters.reportConfigStatic\n    },\n    selected: {\n      // getter\n      get: function() {\n        return this.$store.getters.selected\n      },\n      // setter\n      set: function(newValue) {\n        this.$store.commit('setselected', newValue)\n      }\n    },\n    reportType: {\n      // getter\n      get: function() {\n        return this.$store.getters.reportType\n      },\n      // setter\n      set: function(newValue) {\n        this.$store.commit('setreportType', newValue)\n      }\n    },\n    groupType: {\n      // getter\n      get: function() {\n        return this.$store.getters.groupType\n      },\n      // setter\n      set: function(newValue) {\n        this.$store.commit('setgroupType', newValue)\n      }\n    }\n  },\n  created () {\n    var vm = this\n    vm.$nextTick(function () {\n      setTimeout(() => {\n        vm.showErrorData = false\n        vm.showCSVDownload = false\n        vm.agencyLists = []\n        vm.api = ''\n        vm.filters = []\n        vm.customize = false\n        vm.data = {}\n        vm.groupBy = []\n        vm.itemsReportsConfig = []\n        vm.dataReportXX = ''\n        vm.buttons = []\n        vm.buttonsVal = ''\n        vm.buttonsShow = false\n        vm.exportXML = false\n        vm.nameReport = vm.itemsReports[vm.index]['reportName']\n        if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('reportConfig')) {\n          vm.itemsReportsConfig = vm.itemsReports[vm.index]['filterConfig']['reportConfig']\n        }\n        if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('customize')) {\n          vm.customize = vm.itemsReports[vm.index]['filterConfig']['customize']\n        }\n        if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('autoHeader')) {\n          vm.noHeader = vm.itemsReports[vm.index]['filterConfig']['autoHeader']\n        }\n        if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('groupBy')) {\n          vm.groupBy = vm.itemsReports[vm.index]['filterConfig']['groupBy']\n          let defaultValGroup = vm.groupBy[0]['key']\n          for (let keyGroup in vm.groupBy) {\n            if (vm.groupBy[keyGroup]['selected']) {\n              defaultValGroup = vm.groupBy[keyGroup]['key']\n              break\n            }\n          }\n          vm.groupByVal = defaultValGroup\n        }\n        if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('groupIds')) {\n          vm.agencyLists = vm.itemsReports[vm.index]['filterConfig']['groupIds']\n          if (vm.agencyLists.length > 0) {\n            let defaultVal = vm.agencyLists[0]['value']\n            for (let key in vm.agencyLists) {\n              if (vm.agencyLists[key]['selected']) {\n                defaultVal = vm.agencyLists[key]['value']\n                break\n              }\n            }\n            vm.govAgency = defaultVal\n          }\n        }\n        if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('api')) {\n          vm.api = vm.itemsReports[vm.index]['filterConfig']['api']\n        }\n        if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('filters')) {\n          vm.filters = vm.itemsReports[vm.index]['filterConfig']['filters']\n        }\n        for (let key in vm.filters) {\n          if (vm.filters[key]['type'] === 'select' || vm.filters[key]['type'] === 'date') {\n            vm.data[vm.filters[key]['key']] = vm.filters[key]['value']\n          }\n        }\n        if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('buttons')) {\n          vm.buttons = vm.itemsReports[vm.index]['filterConfig']['buttons']\n          if (vm.buttons.length > 0) {\n            setTimeout(() => {\n              vm.buttonsShow = true\n            }, 100)\n          }\n        }\n        if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('exportXML')) {\n          vm.exportXML = vm.itemsReports[vm.index]['filterConfig']['exportXML']\n        }\n        vm.report1Def = {}\n        for (let key in vm.itemsReportsConfig) {\n          vm.report1Def[vm.itemsReportsConfig[key]['value']] = vm.itemsReportsConfig[key]['text']\n        }\n        vm.reportType = vm.itemsReports[vm.index]['document']\n        if (vm.showConfig) {\n          vm.showConfig = false\n          setTimeout(() => {\n            vm.showConfig = true\n          }, 200)\n        }\n        vm.pdfBlob = ''\n      }, 500)\n    })\n  },\n  watch: {\n    '$route': function (newRoute, oldRoute) {\n      let vm = this\n      console.debug(oldRoute)\n      vm.showErrorData = false\n      vm.showCSVDownload = false\n      vm.itemsReportsConfig = []\n      vm.groupBy = []\n      vm.customize = false\n      vm.data = {}\n      vm.api = ''\n      vm.filters = []\n      vm.report1Def = {}\n      vm.dataReportXX = ''\n      vm.buttons = []\n      vm.buttonsVal = ''\n      vm.buttonsShow = false\n      vm.exportXML = false\n      vm.nameReport = vm.itemsReports[vm.index]['reportName']\n      if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('reportConfig')) {\n        vm.itemsReportsConfig = vm.itemsReports[vm.index]['filterConfig']['reportConfig']\n      }\n      if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('customize')) {\n        vm.customize = vm.itemsReports[vm.index]['filterConfig']['customize']\n      }\n      if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('autoHeader')) {\n        vm.noHeader = vm.itemsReports[vm.index]['filterConfig']['autoHeader']\n      }\n      if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('groupBy')) {\n        vm.groupBy = vm.itemsReports[vm.index]['filterConfig']['groupBy']\n        let defaultValGroup = vm.groupBy[0]['key']\n        for (let keyGroup in vm.groupBy) {\n          if (vm.groupBy[keyGroup]['selected']) {\n            defaultValGroup = vm.groupBy[keyGroup]['key']\n            break\n          }\n        }\n        vm.groupByVal = defaultValGroup\n      }\n      if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('groupIds')) {\n        vm.agencyLists = vm.itemsReports[vm.index]['filterConfig']['groupIds']\n        if (vm.agencyLists.length > 0) {\n          let defaultVal = vm.agencyLists[0]['value']\n          for (let key in vm.agencyLists) {\n            if (vm.agencyLists[key]['selected']) {\n              defaultVal = vm.agencyLists[key]['value']\n              break\n            }\n          }\n          vm.govAgency = defaultVal\n        }\n      }\n      if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('api')) {\n        vm.api = vm.itemsReports[vm.index]['filterConfig']['api']\n      }\n      if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('filters')) {\n        vm.filters = vm.itemsReports[vm.index]['filterConfig']['filters']\n      }\n      for (let key in vm.itemsReportsConfig) {\n        vm.report1Def[vm.itemsReportsConfig[key]['value']] = vm.itemsReportsConfig[key]['text']\n      }\n      vm.reportType = vm.itemsReports[vm.index]['document']\n      vm.pdfBlob = ''\n      for (let key in vm.filters) {\n        if (vm.filters[key]['type'] === 'select' || vm.filters[key]['type'] === 'date') {\n          vm.data[vm.filters[key]['key']] = vm.filters[key]['value']\n        }\n      }\n      if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('buttons')) {\n        vm.buttons = vm.itemsReports[vm.index]['filterConfig']['buttons']\n        if (vm.buttons.length > 0) {\n          setTimeout(() => {\n            vm.buttonsShow = true\n          }, 100)\n        }\n      }\n      if (vm.itemsReports[vm.index]['filterConfig'].hasOwnProperty('exportXML')) {\n        vm.exportXML = vm.itemsReports[vm.index]['filterConfig']['exportXML']\n      }\n      if (vm.showConfig) {\n        vm.showConfig = false\n        setTimeout(() => {\n          vm.showConfig = true\n        }, 200)\n      }\n    }\n  },\n  methods: {\n    doCreatePDF () {\n      let vm = this\n      if (vm.reportType.startsWith('STATISTIC')) {\n        vm.doPrintReportFix()\n      } else {\n        vm.doDynamicReport()\n      }\n      vm.isCallData = true\n    },\n    doDynamicReport () {\n      let vm = this\n      vm.docDefinition = {}\n      let docDString = {}\n      vm.dataReportXX = ''\n      docDString = JSON.stringify(vm.reportConfigStatic[vm.index]['docDefinition'])\n      docDString = docDString.replace(/\\[\\$siteName\\$\\]/g, vm.$store.getters.siteName)\n      for (let key in vm.filters) {\n        let find = vm.filters[key]['key']\n        let currentVal = vm.data[vm.filters[key]['key']]\n        if (currentVal !== '' && currentVal !== undefined && currentVal !== null) {\n          let dateStr = new Date(currentVal).toLocaleDateString('vi-VN')\n          if (dateStr !== 'Invalid Date'&& String(currentVal).length === 13) {\n            docDString = docDString.replace(eval('/\\\\[\\\\$' + find + '\\\\$\\\\]/g'), dateStr)\n          } else {\n            if (vm.filters[key]['type'] === 'select') {\n              for (let keySource in vm.filters[key]['source']) {\n                if (String(vm.filters[key]['source'][keySource]['value']) === String(currentVal)) {\n                  currentVal = vm.filters[key]['source'][keySource]['name']\n                }\n              }\n            }\n            docDString = docDString.replace(eval('/\\\\[\\\\$' + find + '\\\\$\\\\]/g'), currentVal)\n          }\n        } else {\n          currentVal = ''\n          for (let keySource in vm.filters[key]['source']) {\n            if (currentVal === '' || currentVal === '0') {\n              currentVal = vm.filters[key]['source'][keySource]['name']\n              break\n            }\n          }\n          docDString = docDString.replace(eval('/\\\\[\\\\$' + find + '\\\\$\\\\]/g'), currentVal)\n        }\n      }\n      vm.agencyLists = vm.itemsReports[vm.index]['filterConfig']['groupIds']\n      for (let key in vm.agencyLists) {\n        if (String(vm.agencyLists[key]['value']) === String(vm.govAgency)) {\n          docDString = docDString.replace(/\\[\\$groupIds\\$\\]/g, vm.agencyLists[key]['text'])\n          break\n        }\n      }\n      vm.api = vm.itemsReports[vm.index]['filterConfig']['api']\n      let widthsConfig = []\n      widthsConfig.push(30)\n      let headerTableReport = '['\n      let header2TableReport = '['\n      headerTableReport += JSON.stringify({\n        text: 'STT',\n        alignment: 'center',\n        bold: true\n      }) + ','\n      header2TableReport += JSON.stringify({\n        text: '(1)',\n        alignment: 'center',\n        italics: true\n      }) + ','\n      let ine = 2\n      let colLeng = 0\n      for (let key in vm.itemsReportsConfig) {\n        if (vm.itemsReportsConfig[key].hasOwnProperty('selected') && vm.itemsReportsConfig[key]['selected']) {\n          colLeng = colLeng + 1\n          widthsConfig.push('auto')\n          // vm.docDefinition['content'][2]['table']['widths'].push('auto')\n          let str1 = ' '\n          if (vm.report1Def[vm.itemsReportsConfig[key]['value']] !== undefined && vm.report1Def[vm.itemsReportsConfig[key]['value']] !== null && vm.report1Def[vm.itemsReportsConfig[key]['value']] !== '') {\n            str1 = vm.report1Def[vm.itemsReportsConfig[key]['value']]\n          }\n          headerTableReport += JSON.stringify({\n            text: str1,\n            alignment: 'center',\n            bold: true\n          }) + ','\n          header2TableReport += JSON.stringify({\n            text: '(' + ine + ')',\n            alignment: 'center',\n            italics: true\n          }) + ','\n          ine = ine + 1\n        }\n      }\n      if (vm.noHeader) {\n        vm.dataReportXX += headerTableReport.substring(0, headerTableReport.length - 1) + '],'\n        vm.dataReportXX += header2TableReport.substring(0, header2TableReport.length - 1) + '],'\n      }\n      \n      // bild data\n      let filter = {\n        document: vm.reportType,\n        data: vm.data,\n        api: vm.api\n      }\n      filter['govAgency'] = vm.govAgency\n      filter['agencyLists'] = vm.agencyLists\n      vm.pdfBlob = null\n      vm.isShowLoading = true\n      vm.$store.dispatch('getAgencyReportLists', filter).then(function (result) {\n        if (result !== null && result !== undefined) {\n          let dataReport = result\n          let dossierRaw = {}\n          let dataReportCurrent = {}\n          let dataReportTotal = ''\n          let textGroup = ''\n          for (let keyGroup in vm.groupBy) {\n            if (String(vm.groupBy[keyGroup]['key']) === String(vm.groupByVal)) {\n              textGroup = vm.groupBy[keyGroup]['display']\n              break\n            }\n          }\n          for (let key in dataReport) {\n            dataReportCurrent = dataReport[key]\n            if (dossierRaw[dataReportCurrent[vm.groupByVal]] !== '' && dossierRaw[dataReportCurrent[vm.groupByVal]] !== undefined) {\n              if (dossierRaw[dataReportCurrent[vm.groupByVal]][textGroup] === dataReportCurrent[textGroup]) {\n                dossierRaw[dataReportCurrent[vm.groupByVal]]['dossiers'].push(dataReportCurrent)\n                dossierRaw[dataReportCurrent[vm.groupByVal]]['totalChild'] = dossierRaw[dataReportCurrent[vm.groupByVal]]['totalChild'] + 1\n              }\n            } else {\n              let dossierRawItem = {}\n              dossierRawItem[vm.groupByVal] = dataReportCurrent[vm.groupByVal]\n              dossierRawItem[textGroup] = dataReportCurrent[textGroup]\n              dossierRawItem['totalChild'] = 1\n              dossierRawItem['dossiers'] = []\n              dossierRaw[dataReportCurrent[vm.groupByVal]] = dossierRawItem\n              dossierRaw[dataReportCurrent[vm.groupByVal]][textGroup] = dataReportCurrent[textGroup]\n              dossierRaw[dataReportCurrent[vm.groupByVal]]['dossiers'].push(dataReportCurrent)\n            }\n          }\n          let dataToExportCSV = []\n          for (let key in dossierRaw) {\n            if (dossierRaw[key][vm.groupByVal] !== undefined && dossierRaw[key][vm.groupByVal] !== null && dossierRaw[key][vm.groupByVal] !== '') {\n              let csvGroup = []\n              csvGroup.push(dossierRaw[key][vm.groupByVal] + ' - ' + dossierRaw[key][textGroup] + ' ( ' + dossierRaw[key]['totalChild'] + ' ) ')\n              for (let colLengIndex in colLeng) {\n                csvGroup.push('')\n              }\n              dataToExportCSV.push(csvGroup)\n              dataReportTotal += JSON.stringify([{\n                colSpan: colLeng + 1,\n                text: dossierRaw[key][vm.groupByVal] + ' - ' + dossierRaw[key][textGroup] + ' ( ' + dossierRaw[key]['totalChild'] + ' ) ',\n                bold: true,\n                style: 'tdStyle'\n              }]) + ','\n            }\n            /*\n            vm.docDefinition['content'][2]['table']['body'].push([{\n              colSpan: val.length + 1,\n              text: '- ' + domains[0]['services'][key]['serviceCode'] + ' - ' + domains[0]['services'][key]['serviceName'],\n              bold: true,\n              style: 'tdStyle'\n            }])\n            */\n            let dossiersArray = dossierRaw[key]['dossiers']\n            let indexStt = 1\n            let dataRow = []\n            for (let keyDossier in dossiersArray) {\n              dataRow = []\n              let dataToExportCSVItem = []\n              let dossierObj = dossiersArray[keyDossier]\n              dataToExportCSVItem.push(indexStt)\n              dataRow.push({\n                text: indexStt, \n                alignment: 'center',\n                style: 'tdStyle'\n              })\n              for (let keyVal in vm.itemsReportsConfig) {\n                if (vm.itemsReportsConfig[keyVal].hasOwnProperty('selected') && vm.itemsReportsConfig[keyVal]['selected']) {\n                  let alignmentConfig = 'center'\n                  if (vm.itemsReportsConfig[keyVal].hasOwnProperty('align')) {\n                    alignmentConfig = vm.itemsReportsConfig[keyVal]['align']\n                  }\n                  let ddStr = ' '\n                  if (dossierObj[vm.itemsReportsConfig[keyVal]['value']] !== undefined && dossierObj[vm.itemsReportsConfig[keyVal]['value']] !== null && dossierObj[vm.itemsReportsConfig[keyVal]['value']] !== '') {\n                    ddStr = dossierObj[vm.itemsReportsConfig[keyVal]['value']]\n                  }\n                  dataToExportCSVItem.push(ddStr)\n                  dataRow.push({\n                    text: ddStr, \n                    alignment: alignmentConfig,\n                    style: 'tdStyle'\n                  })\n                }\n              }\n              dataReportTotal += JSON.stringify(dataRow) + ','\n              // vm.docDefinition['content'][2]['table']['body'].push(dataRow)\n              indexStt = indexStt + 1\n              dataToExportCSV.push(dataToExportCSVItem)\n            }\n          }\n          dataReportTotal = dataReportTotal.substring(0, dataReportTotal.length - 1)\n          vm.dataReportXX += dataReportTotal\n          // }\n          vm.csvExport = []\n          vm.csvExport = dataToExportCSV\n          vm.fields = []\n          vm.fields.push('STT')\n          for (let excelKey in vm.itemsReportsConfig) {\n            if (vm.itemsReportsConfig[excelKey]['selected']) {\n              let stringColumn = vm.itemsReportsConfig[excelKey]['value']\n              if (vm.itemsReportsConfig[excelKey]['text'] !== '') {\n                stringColumn = vm.itemsReportsConfig[excelKey]['text']\n              }\n              vm.fields.push(stringColumn)\n            }\n          }\n          vm.showCSVDownload = true\n          docDString = docDString.replace(/\"\\[\\$tableWidth\\$\\]\"/g, JSON.stringify(widthsConfig))\n          docDString = docDString.replace(/\"\\[\\$report\\$\\]\"/g, vm.dataReportXX)\n          vm.docDefinition = JSON.parse(docDString)\n          let pdfDocGenerator = pdfMake.createPdf(vm.docDefinition)\n          pdfDocGenerator.getBlob((blob) => {\n            vm.pdfBlob = window.URL.createObjectURL(blob)\n            vm.isShowLoading = false\n            if (vm.doExportExcel) {\n              let currentTimestemp = new Date().getTime()\n              let fileToExcel = new File([blob], currentTimestemp + '.pdf')\n              {\n                var reader = new FileReader()\n                reader.onload = function(e) {\n                    var data = e.target.result\n                    console.log('data', data)\n                    vm.convertPDFToHTML(data)\n                };\n                reader.readAsArrayBuffer(fileToExcel)\n              }\n            }\n          })\n        } else {\n          // vm.agencyLists = []\n          vm.isShowLoading = false\n          vm.showErrorData = true\n        }\n      })\n    },\n    doPrintReportFix () {\n      let vm = this\n      vm.agencyLists = []\n      vm.api = ''\n      vm.dataReportXX = ''\n      vm.docDefinition = {}\n      let docDString = {}\n      docDString = JSON.stringify(vm.reportConfigStatic[vm.index]['docDefinition'])\n      docDString = docDString.replace(/\\[\\$siteName\\$\\]/g, vm.$store.getters.siteName)\n      for (let key in vm.filters) {\n        let find = vm.filters[key]['key']\n        let currentVal = vm.data[vm.filters[key]['key']]\n        if (currentVal !== '' && currentVal !== undefined && currentVal !== null) {\n          let dateStr = new Date(currentVal).toLocaleDateString('vi-VN')\n          if (dateStr !== 'Invalid Date'&& String(currentVal).length === 13) {\n            docDString = docDString.replace(eval('/\\\\[\\\\$' + find + '\\\\$\\\\]/g'), dateStr)\n          } else {\n            if (vm.filters[key]['type'] === 'select') {\n              for (let keySource in vm.filters[key]['source']) {\n                if (String(vm.filters[key]['source'][keySource]['value']) === String(currentVal)) {\n                  currentVal = vm.filters[key]['source'][keySource]['name']\n                }\n              }\n            }\n            docDString = docDString.replace(eval('/\\\\[\\\\$' + find + '\\\\$\\\\]/g'), currentVal)\n          }\n        } else {\n          currentVal = ''\n          for (let keySource in vm.filters[key]['source']) {\n            if (currentVal === '' || currentVal === '0') {\n              currentVal = vm.filters[key]['source'][keySource]['name']\n              break\n            }\n          }\n          docDString = docDString.replace(eval('/\\\\[\\\\$' + find + '\\\\$\\\\]/g'), currentVal)\n        }\n      }\n      vm.agencyLists = vm.itemsReports[vm.index]['filterConfig']['groupIds']\n      for (let key in vm.agencyLists) {\n        if (String(vm.agencyLists[key]['value']) === String(vm.govAgency)) {\n          docDString = docDString.replace(/\\[\\$groupIds\\$\\]/g, vm.agencyLists[key]['text'])\n          break\n        }\n      }\n      vm.api = vm.itemsReports[vm.index]['filterConfig']['api']\n      vm.isShowLoading = true\n      let filter = {\n        document: vm.reportType,\n        data: vm.data,\n        api: vm.api\n      }\n      filter['govAgency'] = vm.govAgency\n      filter['agencyLists'] = vm.agencyLists\n      vm.pdfBlob = null\n      vm.isShowLoading = true\n      let sumKey = vm.itemsReports[vm.index]['filterConfig']['sumKey']\n      let selection = vm.itemsReports[vm.index]['filterConfig']['selection']\n      let merge = vm.itemsReports[vm.index]['filterConfig']['merge']\n      let sort = vm.itemsReports[vm.index]['filterConfig']['sort']\n      let subKey = vm.itemsReports[vm.index]['filterConfig']['subKey']\n      vm.$store.dispatch('getAgencyReportLists', filter).then(function (result) {\n        if (result !== null) {\n          let index = 1\n          let dataRowTotal = []\n          let totalText = 'Tổng số'\n          if (sumKey === 'month') {\n            totalText = 'Cả năm'\n          }\n          dataRowTotal.push({\n            text: totalText, \n            colSpan: 2,\n            bold: true,\n            alignment: 'center',\n            style: 'tdStyle'\n          })\n          for (let keyMapping in vm.itemsReportsConfig) {\n            if (vm.itemsReportsConfig[keyMapping]['value'] === 'note') {\n              dataRowTotal.push({\n                text: '', \n                alignment: 'center',\n                style: 'tdStyle'\n              })\n            }  else {\n              dataRowTotal.push({\n                text: 0, \n                alignment: 'center',\n                style: 'tdStyle'\n              })\n            }\n          }\n          \n          // TODO\n          let resultData = result\n          if (selection !== undefined && selection !== null && selection.length > 0) {\n            resultData = result.filter(function(obj) {\n              let totalCHK = 0\n              for (let keySe in selection) {\n                if (selection[keySe]['compare'] === '#') {\n                  if (String(obj[selection[keySe]['key']]) !== String(selection[keySe]['value'])) {\n                    totalCHK = totalCHK + 1\n                    // return obj\n                  }\n                } else if (selection[keySe]['compare'] === '=') {\n                  if (selection[keySe]['value'] === '') {\n                    if (String(obj[selection[keySe]['key']]) === '' || obj[selection[keySe]['key']] === undefined || obj[selection[keySe]['key']] === null) {\n                      totalCHK = totalCHK + 1\n                      // return obj\n                    }\n                  } else {\n                    if (String(obj[selection[keySe]['key']]) === String(selection[keySe]['value'])) {\n                      totalCHK = totalCHK + 1\n                      // return obj\n                    }\n                  }\n                } else {\n                  if (String(obj[selection[keySe]['key']]) === '' || obj[selection[keySe]['key']] === undefined || obj[selection[keySe]['key']] === null) {\n                    totalCHK = totalCHK + 1\n                    // return obj\n                  }\n                }\n              }\n              if (totalCHK === selection.length) {\n                return obj\n              }\n            })\n          }\n          let resultDataTotal = resultData.filter(function(obj) {\n            if (subKey !== null && subKey !== undefined && subKey !== '') {\n              if ((obj[sumKey] === '' || String(obj[sumKey]) === '0' || obj[sumKey] === undefined || obj[sumKey] === null) && obj[subKey] === '') {\n                return obj\n              }\n            } else {\n              if (obj[sumKey] === '' || String(obj[sumKey]) === '0' || obj[sumKey] === undefined || obj[sumKey] === null) {\n                return obj\n              }\n            }\n          })\n          let resultDataVari = {}\n          for (let key in resultData) {\n            let keyVari = ''\n            for (let keysd in merge) {\n              keyVari += resultData[key][merge[keysd]] + '_'\n            }\n            if (resultDataVari[keyVari] === undefined || resultDataVari[keyVari] === null || resultDataVari[keyVari] === '') {\n              resultDataVari[keyVari] = resultData[key]\n            } else {\n              for (let kkey in resultDataVari[keyVari]) {\n                if (resultDataVari[keyVari][kkey] !== '' && resultDataVari[keyVari][kkey] !== undefined && resultDataVari[keyVari][kkey] !== null) {\n                  if (String(parseInt(resultDataVari[keyVari][kkey])) === 'NaN') {\n                    resultDataVari[keyVari][kkey] = resultData[key][kkey]\n                  } else if (kkey === 'ontimePercentage') {\n                    resultDataVari[keyVari][kkey] = parseInt(resultData[key][kkey])\n                  } else if (kkey === 'month' || kkey === 'year') {\n                    resultDataVari[keyVari][kkey] = parseInt(resultData[key][kkey])\n                  } else {\n                    resultDataVari[keyVari][kkey] = parseInt(resultData[key][kkey]) + parseInt(resultDataVari[keyVari][kkey])\n                  }\n                }\n              }\n            }\n          }\n          resultData = []\n          for (let key in resultDataVari) {\n            if (key !== undefined && !key.startsWith('undefined')) {\n              resultData.push(resultDataVari[key])\n            }\n          }\n          if (sort !== '' && sort !== undefined && sort !== null) {\n            resultData = vm.sortByKey(resultData, sort)\n          }\n          if (subKey !== null && subKey !== undefined && subKey !== '') {\n            let arraySubKey = {}\n            for (let key in resultData) {\n              if ((resultData[key][sumKey] !== '' && String(resultData[key][sumKey]) !== '0' && resultData[key][sumKey] !== undefined && resultData[key][sumKey] !== null) ||\n                (subKey !== null && subKey !== undefined && subKey !== '' && resultData[key][subKey] === '' && resultData[key][sumKey] !== '' && resultData[key][sumKey] !== '0')) {\n                if (arraySubKey[resultData[key][sumKey]] !== undefined && arraySubKey[resultData[key][sumKey]] !== null) {\n                  arraySubKey[resultData[key][sumKey]].push(resultData[key])\n                } else {\n                  arraySubKey[resultData[key][sumKey]] = []\n                  arraySubKey[resultData[key][sumKey]].push(resultData[key])\n                }\n              }\n            }\n            resultData = []\n            for (let keySUBARRAY in arraySubKey) {\n              let subKeySortData = vm.sortByKey(arraySubKey[keySUBARRAY], subKey)\n              for (let keyData in subKeySortData) {\n                resultData.push(subKeySortData[keyData])\n              }\n            }\n          }\n          let dataToExportCSV = []\n          for (let key in resultData) {\n            let dataInput = resultData[key]\n            if ((resultData[key][sumKey] !== '' && String(resultData[key][sumKey]) !== '0' && resultData[key][sumKey] !== undefined && resultData[key][sumKey] !== null) ||\n                (subKey !== null && subKey !== undefined && subKey !== '' && resultData[key][subKey] === '' && resultData[key][sumKey] !== '' && String(resultData[key][sumKey]) !== '0')) {\n              let dataRow = []\n              let dataToExportCSVItem = []\n              if (subKey !== null && subKey !== undefined && subKey !== '' && resultData[key][subKey] !== '') {\n                dataToExportCSVItem.push('')\n                dataRow.push({\n                  text: '', \n                  alignment: 'center',\n                  style: 'tdStyle'\n                })\n              } else {\n                dataToExportCSVItem.push(index)\n                dataRow.push({\n                  text: index, \n                  alignment: 'center',\n                  style: 'tdStyle'\n                })\n              }\n              let indexTotal = 1\n              for (let keyMapping in vm.itemsReportsConfig) {\n                let currentConfig = vm.itemsReportsConfig[keyMapping]\n                let dataText = ' '\n                let preff = currentConfig.hasOwnProperty('prefix') ? currentConfig['prefix'] : ''\n                if (currentConfig.hasOwnProperty('calculator')) {\n                  dataText = Math.round(eval(currentConfig['calculator']))\n                } else {\n                  if (resultData[key][currentConfig['value']] !== undefined && resultData[key][currentConfig['value']] !== null) {\n                    if (currentConfig.hasOwnProperty('subValue') && resultData[key][subKey] !== '') {\n                      dataText =  ' - ' + resultData[key][currentConfig['subValue']] + ' '\n                    } else {\n                      dataText = preff + ' ' + resultData[key][currentConfig['value']] + ' '\n                    }\n                  }\n                }\n                let alignmentConfig = 'center'\n                if (currentConfig.hasOwnProperty('align')) {\n                  alignmentConfig = currentConfig['align']\n                }\n                dataToExportCSVItem.push(dataText)\n                dataRow.push({\n                  text: dataText, \n                  alignment: alignmentConfig,\n                  style: 'tdStyle'\n                })\n                if (vm.govAgency === 0) {\n                  if (dataRowTotal[indexTotal] !== null && dataRowTotal[indexTotal] !== undefined && dataRowTotal[indexTotal]['text'] !== '') {\n                    if (currentConfig['value'] === 'ontimePercentage') {\n                      dataRowTotal[indexTotal]['text'] = parseInt(dataText)\n                    } else if (isNaN(dataText)) {\n                      dataRowTotal[indexTotal]['text'] = ' '\n                    } else {\n                      dataRowTotal[indexTotal]['text'] = parseInt(dataRowTotal[indexTotal]['text']) + parseInt(dataText)\n                    }\n                  }\n                }\n                indexTotal = indexTotal + 1\n              }\n              if (subKey !== null && subKey !== undefined && subKey !== '' && resultData[key][subKey] !== '') {\n                \n              } else {\n                index = index + 1\n              }\n              // vm.docDefinition['content'][2]['table']['body'].push(dataRow)\n              vm.dataReportXX += JSON.stringify(dataRow) + ','\n              dataToExportCSV.push(dataToExportCSVItem)\n            }\n          }\n          if (vm.agencyLists.length > 0 && vm.govAgency === 0) {\n            /*\n            let resultDataVariTotal = {}\n            for (let key in resultDataTotal) {\n              let keyVari = ''\n              for (let keysd in merge) {\n                keyVari += resultDataTotal[key][merge[keysd]] + '_'\n              }\n              if (resultDataVariTotal[keyVari] === undefined || resultDataVariTotal[keyVari] === null || resultDataVariTotal[keyVari] === '') {\n                resultDataVariTotal[keyVari] = resultDataTotal[key]\n              } else {\n                for (let kkey in resultDataVariTotal[keyVari]) {\n                  if (resultDataVariTotal[keyVari][kkey] !== '' && resultDataVariTotal[keyVari][kkey] !== undefined && resultDataVariTotal[keyVari][kkey] !== null) {\n                    if (String(parseInt(resultDataVariTotal[keyVari][kkey])) === 'NaN') {\n                      resultDataVariTotal[keyVari][kkey] = resultDataTotal[key][kkey]\n                    } else if (kkey === 'ontimePercentage') {\n                      resultDataVariTotal[keyVari][kkey] = parseInt(resultDataVariTotal[keyVari][kkey])\n                    } else {\n                      resultDataVariTotal[keyVari][kkey] = parseInt(resultDataTotal[key][kkey]) + parseInt(resultDataVariTotal[keyVari][kkey])\n                    }\n                  }\n                }\n              }\n            }\n            resultDataTotal = []\n            for (let key in resultDataVariTotal) {\n              if (key === undefined || key === 'undefined_') {\n                resultDataTotal.push(resultDataVariTotal[key])\n              }\n            }\n            */\n            for (let keyXXTT in resultDataTotal) {\n              let indexTotalXXTT = 1\n              let dataInputXXTT = ''\n              dataInputXXTT = resultDataTotal[keyXXTT]\n              for (let keyMappingXXTT in vm.itemsReportsConfig) {\n                let dataTextXXTT = ''\n                let currentConfigXXTT = vm.itemsReportsConfig[keyMappingXXTT]\n                if (currentConfigXXTT.hasOwnProperty('calculator')) {\n                  console.log('dataInputXXTT', dataInputXXTT)\n                  dataTextXXTT = Math.round(eval(currentConfigXXTT['calculator'].replace(/dataInput/g, 'dataInputXXTT')))\n                  console.log('dataTextXXTT', dataTextXXTT)\n                } else if (resultDataTotal[keyXXTT][currentConfigXXTT['value']] !== undefined && resultDataTotal[keyXXTT][currentConfigXXTT['value']] !== null && resultDataTotal[keyXXTT][currentConfigXXTT['value']] !== '') {\n                  dataTextXXTT = resultDataTotal[keyXXTT][currentConfigXXTT['value']] + ' '\n                }\n                dataRowTotal[indexTotalXXTT]['text'] = parseInt(dataTextXXTT) + ' '\n                indexTotalXXTT = indexTotalXXTT + 1\n              }\n              break\n            }\n          } else {\n            for (let keyXXTT in resultDataTotal) {\n              let indexTotalXXTT = 1\n              let dataInputXXTT = ''\n              dataInputXXTT = resultDataTotal[keyXXTT]\n              for (let keyMappingXXTT in vm.itemsReportsConfig) {\n                let dataTextXXTT = ''\n                let currentConfigXXTT = vm.itemsReportsConfig[keyMappingXXTT]\n                if (currentConfigXXTT.hasOwnProperty('calculator')) {\n                  dataTextXXTT = Math.round(eval(currentConfigXXTT['calculator'].replace(/dataInput/g, 'dataInputXXTT')))\n                } else if (resultDataTotal[keyXXTT][currentConfigXXTT['value']] !== undefined && resultDataTotal[keyXXTT][currentConfigXXTT['value']] !== null && resultDataTotal[keyXXTT][currentConfigXXTT['value']] !== '') {\n                  dataTextXXTT = resultDataTotal[keyXXTT][currentConfigXXTT['value']] + ' '\n                }\n                dataRowTotal[indexTotalXXTT]['text'] = parseInt(dataTextXXTT) + ' '\n                indexTotalXXTT = indexTotalXXTT + 1\n              }\n            }\n          }\n          console.log('dataRowTotal: ', dataRowTotal)\n          vm.dataReportXX += JSON.stringify(dataRowTotal)\n          dataToExportCSV\n          let itemTotal = []\n          for (let keyTotalCSV in dataRowTotal) {\n            itemTotal.push(dataRowTotal[keyTotalCSV]['text'])\n          }\n          dataToExportCSV.push(itemTotal)\n          vm.csvExport = []\n          vm.csvExport = dataToExportCSV\n          vm.fields = []\n          vm.fields.push('STT')\n          vm.fields.push(sumKey)\n          for (let excelKey in vm.itemsReportsConfig) {\n            if (vm.itemsReportsConfig[excelKey]['selected']) {\n              let stringColumn = vm.itemsReportsConfig[excelKey]['value']\n              if (vm.itemsReportsConfig[excelKey]['text'] !== '') {\n                stringColumn = vm.itemsReportsConfig[excelKey]['text']\n              }\n              vm.fields.push(stringColumn)\n            }\n          }\n          vm.showCSVDownload = true\n          docDString = docDString.replace(/\"\\[\\$report\\$\\]\"/g, vm.dataReportXX)\n          // vm.docDefinition['content'][2]['table']['body'].push(dataRowTotal)\n          vm.docDefinition = JSON.parse(docDString)\n          let pdfDocGenerator = pdfMake.createPdf(vm.docDefinition)\n          pdfDocGenerator.getBlob((blob) => {\n            vm.pdfBlob = window.URL.createObjectURL(blob)\n            vm.isShowLoading = false\n            if (vm.doExportExcel) {\n              let currentTimestemp = new Date().getTime()\n              let fileToExcel = new File([blob], currentTimestemp + '.pdf')\n              {\n                var reader = new FileReader()\n                reader.onload = function(e) {\n                    var data = e.target.result\n                    console.log('data', data)\n                    vm.convertPDFToHTML(data)\n                };\n                reader.readAsArrayBuffer(fileToExcel)\n              }\n            }\n          })\n        } else {\n          // vm.agencyLists = []\n          vm.isShowLoading = false\n          vm.showErrorData = true\n        }\n      })\n    },\n    doCreateReport(isExportExcel) {\n      let vm = this\n      if (vm.$refs.form.validate()) {\n        vm.doExportExcel = isExportExcel\n        vm.showConfig = false\n        vm.doCreatePDF()\n      }\n    },\n    sortByKey (array, key) {\n      return array.sort(function(a, b) {\n        var x = a[key]; var y = b[key];\n        return ((x < y) ? -1 : ((x > y) ? 1 : 0));\n      })\n    },\n    changeConfig (index) {\n      let vm = this\n      if (vm.itemsReportsConfig[index].hasOwnProperty('selected')) {\n        if (vm.itemsReportsConfig[index]['selected']) {\n          vm.itemsReportsConfig[index]['selected'] = false\n        } else {\n          vm.itemsReportsConfig[index]['selected'] = true\n        }\n      } else {\n        vm.itemsReportsConfig[index]['selected'] = true\n      }\n    },\n    doChotSoLieu (dataSelect, button) {\n      let vm = this\n      let filter = {\n        api: button['api'],\n        key: button['key'],\n        value: dataSelect,\n        data: vm.data\n      }\n      vm.$store.dispatch('doChotSoLieu', filter).then(function () {\n        vm.doCreatePDF()\n      })\n    },\n    reloadPickerChange (key) {\n      let vm = this\n      vm.showPicker = false\n      setTimeout(() => {\n        vm.data[key] = new Date(vm.data[key]).toLocaleDateString('vi-VN')\n        vm.showPicker = true\n      }, 200)\n    },\n    sdfsdfdsf () {\n      let vm = this\n      vm.$store.dispatch('doExportXlsxddd')\n    },\n    toDoNotDone () {\n      alert('Đang phát triển.')\n    },\n    doDynamicReportXML () {\n      let vm = this\n      vm.agencyLists = vm.itemsReports[vm.index]['filterConfig']['groupIds']\n      vm.jsonMapperJson = {}\n      vm.jsonMapperJson = vm.itemsReports[vm.index]['userConfig']\n      vm.api = vm.itemsReports[vm.index]['filterConfig']['api']\n      // bild data\n      let filter = {\n        document: vm.reportType,\n        data: vm.data,\n        api: vm.api\n      }\n      filter['govAgency'] = vm.govAgency\n      filter['agencyLists'] = vm.agencyLists\n      vm.$store.dispatch('getAgencyReportLists', filter).then(function (result) {\n        if (result !== null && result !== undefined) {\n          jsonMapper({ 'content': result, 'blank': '' }, vm.jsonMapperJson).then((result) => {\n            console.log(result)\n            const xmlOptions = {\n              header: true,\n              indent: '  '\n            };\n            let xmlToExport = toXML(result, xmlOptions)\n            var blob = new Blob([ new TextEncoder().encode( xmlToExport ) ], {\n                type: \"text/plain;charset=utf-8;\",\n            })\n            saveAs(blob, new Date().getTime() + \".xml\");\n          })\n        }\n      })\n    },\n    convertPDFToHTML (content) {\n      let vm = this\n      window.PDFJS.getDocument(content).then(window.pdf_table_extractor).then(function (result) {\n        let all_tables = [];\n        let page_tables = result.pageTables.shift()\n        all_tables = all_tables.concat(page_tables.tables);\n        let table_dom = $('<table></table>').attr('border', 1);\n        let tables = page_tables.tables;\n        let merge_alias = page_tables.merge_alias;\n        let merges = page_tables.merges;\n\n        for (let r = 0; r < tables.length; r++) {\n          let tr_dom = $('<tr></tr>')\n          for (let c = 0; c < tables[r].length; c++) {\n            let r_c = [r, c].join('-')\n            if (merge_alias[r_c]) {\n              continue\n            }\n            let td_dom = $('<td></td>');\n            if (merges[r_c]) {\n              if (merges[r_c].width > 1) {\n                td_dom.attr('colspan', merges[r_c].width)\n              }\n              if (merges[r_c].height > 1) {\n                td_dom.attr('rowspan', merges[r_c].height)\n              }\n            }\n            td_dom.html(tables[r][c].replace(/\\n/ig, '<br/>').replace(/↵/ig, '<br/>'))\n            tr_dom.append(td_dom)\n          }\n          table_dom.append(tr_dom)\n        }\n         var tab_text = '<html xmlns:x=\"urn:schemas-microsoft-com:office:excel\">'\n        tab_text = tab_text + '<head><meta http-equiv=\"content-type\" content=\"text/html; charset=UTF-8\"/><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>'\n        tab_text = tab_text + '<x:Name>Test Sheet</x:Name>'\n        tab_text = tab_text + '<x:WorksheetOptions><x:Panes></x:Panes></x:WorksheetOptions></x:ExcelWorksheet>'\n        tab_text = tab_text + '</x:ExcelWorksheets></x:ExcelWorkbook></xml></head><body>'\n        \n        tab_text = tab_text + '<table></table><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tbody><tr><td colspan=\"10\" valign=\"top\" width=\"167\"><p align=\"center\"><strong>TỔNG CỤC ĐBVN (UBND TỈNH ……)</strong><br>Cục QLĐB (Sở GTVT)…..<br><strong>-------</strong></p></td><td valign=\"top\" width=\"275\" colspan=\"10\"><p align=\"center\"><strong>CỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM<br>Độc lập - Tự do - Hạnh phúc <br>---------------</strong></p></td></tr></tbody></table><table></table>';\n        tab_text = tab_text + '<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tbody><tr><td colspan=\"20\" valign=\"top\" width=\"167\"><p align=\"center\"><strong>TỔNG HỢP HỒ SƠ NỘP TRỰC TUYẾN THEO LĨNH VỰC</strong></p></td></td></tr></tbody></table><table></table>';\n\n        tab_text = tab_text + \"<table border='1px'>\"\n        tab_text = tab_text + table_dom[0].innerHTML\n        \n        tab_text = tab_text + '<table></table><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tbody><tr><td colspan=\"4\" valign=\"top\" width=\"167\"><p align=\"left\"><strong>Nơi nhận:</strong></p></td><td valign=\"top\" width=\"275\" colspan=\"16\"><p align=\"right\"><strong>THỦ TRƯỞNG ĐƠN VỊ</strong><br/>(Ký và ghi rõ họ tên)</p></td></tr></tbody></table><table></table>';\n        tab_text = tab_text + '</body></html>';\n\n        var blob = new Blob([ new TextEncoder().encode( tab_text ) ], {\n          type: 'application/octet-stream',\n        })\n        saveAs(blob, new Date().getTime() + \".xls\");\n      })\n    },\n    s2ab (s) {\n      var buf = new ArrayBuffer(s.length);\n      var view = new Uint8Array(buf);\n      for (var i=0; i!=s.length; ++i) view[i] = s.charCodeAt(i) & 0xFF;\n      return buf;\n    }\n  }\n}\n</script>\n"]}]}
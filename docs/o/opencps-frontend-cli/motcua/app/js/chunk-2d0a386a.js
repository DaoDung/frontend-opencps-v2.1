(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0a386a"],{"030a":function(t,s,e){"use strict";e.r(s);var i=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("v-form",{ref:"formImport",attrs:{"lazy-validation":""},model:{value:t.validTNHS,callback:function(s){t.validTNHS=s},expression:"validTNHS"}},[e("div",{staticClass:"row-header"},[e("div",{staticClass:"background-triangle-big"},[e("span",[t._v("IMPORT HỒ SƠ")])]),e("div",{staticClass:"layout row wrap header_tools row-blue"},[e("div",{staticClass:"flex xs8 sm10 pl-3 text-ellipsis text-bold",attrs:{title:t.thongTinChiTietHoSo.serviceName}},[t._v("\n        "+t._s(t.thongTinChiTietHoSo.serviceName)+"\n      ")]),e("div",{staticClass:"flex xs4 sm2 text-right",staticStyle:{"margin-left":"auto"}},[e("v-btn",{staticClass:"my-0 mx-0 btn-border-left",attrs:{flat:"","active-class":"temp_active"},on:{click:t.goBack}},[e("v-icon",{attrs:{size:"18"}},[t._v("reply")]),t._v("  \n          Quay lại\n        ")],1)],1)])]),e("div",{staticStyle:{position:"relative"}},[e("thong-tin-chu-ho-so",{ref:"thongtinchuhoso",attrs:{showApplicant:!0}})],1),e("div",{staticStyle:{position:"relative"}},[e("v-expansion-panel",{staticClass:"expansion-pl",attrs:{value:[!0],expand:""}},[e("v-expansion-panel-content",[e("div",{staticStyle:{display:"flex","align-items":"center"},attrs:{slot:"header"},slot:"header"},[e("div",{staticClass:"background-triangle-small"},[e("v-icon",{attrs:{size:"18",color:"white"}},[t._v("star_rate")])],1),t._v("\n          Thành phần hồ sơ     \n          "),t.stateEditSample||1===t.originality?1!==t.originality?e("v-text-field",{staticClass:"px-0 py-0",staticStyle:{width:"90px","max-width":"90px"},attrs:{type:"number"},model:{value:t.thongTinChiTietHoSo.sampleCount,callback:function(s){t.$set(t.thongTinChiTietHoSo,"sampleCount",s)},expression:"thongTinChiTietHoSo.sampleCount"}}):t._e():e("span",[t._v("("+t._s(0===t.thongTinChiTietHoSo.sampleCount?"?":t.thongTinChiTietHoSo.sampleCount)+" bộ hồ sơ)")]),t._v("  \n          "),t.stateEditSample||1===t.originality?1!==t.originality?e("v-icon",{staticStyle:{cursor:"pointer"},attrs:{size:"16",color:"primary"},on:{click:function(s){s.stopPropagation(),t.stateEditSample=!t.stateEditSample}}},[t._v("done")]):t._e():e("v-icon",{staticStyle:{cursor:"pointer"},attrs:{size:"16",color:"primary"},on:{click:function(s){s.stopPropagation(),t.stateEditSample=!t.stateEditSample}}},[t._v("edit")])],1),e("thanh-phan-ho-so",{ref:"thanhphanhoso",attrs:{onlyView:!1,id:"nm",partTypes:t.inputTypes}})],1)],1)],1),e("div",{staticStyle:{position:"relative"}},[e("v-expansion-panel",{staticClass:"expansion-pl",attrs:{value:[!0],expand:""}},[e("v-expansion-panel-content",{attrs:{"hide-actions":"",value:"2"}},[e("div",{attrs:{slot:"header"},slot:"header"},[e("div",{staticClass:"background-triangle-small"},[e("v-icon",{attrs:{size:"18",color:"white"}},[t._v("star_rate")])],1),t._v("Dịch vụ chuyển phát kết quả")]),e("dich-vu-chuyen-phat-ket-qua",{ref:"dichvuchuyenphatketqua"})],1)],1)],1),e("div",{staticClass:"py-2",staticStyle:{position:"relative"}},[e("div",{staticClass:"text-xs-center",staticStyle:{width:"100%"}},[e("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"dossierImport"},on:{change:function(s){t.uploadfileDossierImport(s)}}}),e("span",{staticClass:"text-bold",staticStyle:{color:"#004b94!important"}},[t._v("Tải lên file thông tin chủ hồ sơ (Định dạng: .xlsx, .xls)")]),t.progressUploadFile?e("v-progress-circular",{attrs:{width:2,size:25,color:"green",indeterminate:""}}):e("v-tooltip",{staticClass:"ml-2",attrs:{top:""}},[e("v-btn",{staticClass:"mx-0 my-0",attrs:{slot:"activator",icon:""},on:{click:function(s){t.pickFile()}},slot:"activator"},[e("v-badge",[e("v-icon",{attrs:{size:"24",color:"#004b94"}},[t._v("cloud_upload")])],1)],1),e("span",[t._v("Tải file lên")])],1)],1)]),e("v-tabs",{staticClass:"mb-4",attrs:{"icons-and-text":"",centered:""}},[e("v-tabs-slider",{attrs:{color:"primary"}}),e("v-tab",{staticClass:"px-0 py-0",attrs:{href:"#tab-5"},on:{click:t.goBack}},[e("v-btn",{attrs:{flat:"",loading:t.loadingAction,disabled:t.loadingAction}},[e("v-icon",{attrs:{size:"18"}},[t._v("reply")]),t._v("  \n        Quay lại\n        "),e("span",{attrs:{slot:"loader"},slot:"loader"},[t._v("Loading...")])],1)],1)],1)],1),e("v-dialog",{attrs:{"max-width":"700",transition:"fade-transition"},model:{value:t.dialogImportDosier,callback:function(s){t.dialogImportDosier=s},expression:"dialogImportDosier"}},[e("v-card",[e("v-toolbar",{attrs:{flat:"",dark:"",color:"primary"}},[e("v-toolbar-title",[t._v("Import hồ sơ")]),e("v-spacer"),e("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(s){t.dialogImportDosier=!1}}},[e("v-icon",[t._v("close")])],1)],1),e("v-card-text",{staticClass:"pt-0 pb-0 px-0"},[e("v-flex",{staticClass:"text-xs-center"},[e("v-progress-circular",{staticClass:"my-2",attrs:{rotate:-90,size:70,width:10,value:t.valueProgress,color:"primary"}},[e("span",{staticStyle:{"font-size":"1.5em","font-weight":"bold"}},[t._v(t._s(t.countDossierProgress))])]),e("div",{staticClass:"pb-0",staticStyle:{margin:"0 auto"}},[e("v-card",{staticClass:"py-0"},[e("span",{staticStyle:{color:"green"}},[t._v("Thành công: "+t._s(t.countDossierSuccess)+" hồ sơ")]),e("p",{staticStyle:{color:"red"}},[t._v("Lỗi: "+t._s(t.dossierError.length)+" hồ sơ")])])],1)],1),t.dossierError.length&&!t.loadingImportDossier?e("div",{staticClass:"px-2",staticStyle:{margin:"0 auto"}},[e("span",{staticStyle:{"font-size":"1.2em","font-weight":"bold"}},[t._v("Danh sách hồ sơ bị lỗi:")]),e("v-data-table",{staticClass:"table-landing table-bordered mt-2",staticStyle:{"border-left":"1px solid #dedede"},attrs:{headers:t.headers,items:t.dossierError,"hide-actions":"","item-key":"dossierId"},scopedSlots:t._u([{key:"items",fn:function(s){return[e("tr",{staticStyle:{cursor:"pointer"}},[e("td",{staticClass:"text-xs-center",attrs:{width:""}},[e("span",[t._v(t._s(s.index+1))])]),e("td",{staticClass:"text-xs-left",attrs:{width:""}},[t._v("\n                  "+t._s(s.item.applicantName)+"\n                ")]),e("td",{staticClass:"text-xs-left"},[t._v("\n                  "+t._s(s.item.applicantIdNo)+"\n                ")]),e("td",{staticClass:"text-xs-left",attrs:{width:""}},[t._v("\n                  "+t._s(s.item.address)+"\n                ")])])]}}])})],1):t._e()],1),e("v-card-actions",[e("v-spacer"),t.dossierError.length?e("v-btn",{attrs:{color:"primary",loading:t.loadingImportDossier,disabled:t.loadingImportDossier},nativeOn:{click:function(s){t.addDossierAgain()}}},[e("v-icon",[t._v("send")]),t._v(" \n            Thực hiện lại\n            "),e("span",{attrs:{slot:"loader"},slot:"loader"},[t._v("Loading...")])],1):t._e(),e("v-btn",{staticStyle:{color:"#fff"},attrs:{color:"red",loading:t.loadingImportDossier,disabled:t.loadingImportDossier},nativeOn:{click:function(s){t.dialogImportDosier=!1}}},[e("v-icon",[t._v("reply")]),t._v(" \n          Quay lại\n          "),e("span",{attrs:{slot:"loader"},slot:"loader"},[t._v("Loading...")])],1)],1)],1)],1)],1)},o=[],r=e("5176"),a=e.n(r),n=e("f499"),l=e.n(n),c=e("795b"),d=e.n(c),h=(e("5df3"),e("ac6a"),e("854a")),p=e.n(h),u=e("1157"),v=e.n(u),g=e("6e92"),m=e("826a"),f=e("a9a9");p.a.options={closeButton:!0,timeOut:"5000"};var y={props:["index","id","formCode"],components:{"thong-tin-chu-ho-so":m["a"],"thanh-phan-ho-so":g["a"],"dich-vu-chuyen-phat-ket-qua":f["a"]},data:function(){return{validTNHS:!1,dossierId:"",mark:!0,dossierFiles:"",stateEditSample:!1,tiepNhanState:!0,thongTinChiTietHoSo:{},payments:{},paymentProfile:{},briefNote:"",receiveDateEdit:"",editableDate:!1,dueDateEdit:"",viaPortalDetail:0,showThuPhi:!1,inputTypes:[1,3],outputTypes:[2],sampleCount:0,isMobile:!1,loadingAction:!1,countDossierProgress:0,dialogImportDosier:!1,listDossierImport:[],progressUploadFile:!1,loadingImportDossier:!1,dossierError:[],dossierSuccess:[],totalDossier:0,valueProgress:0,countDossierSuccess:0,headers:[{text:"STT",align:"center",sortable:!1},{text:"Chủ hồ sơ",align:"center",sortable:!1},{text:"Mã CMND/CCCD",align:"center",sortable:!1},{text:"Địa chỉ",align:"center",sortable:!1}]}},computed:{loading:function(){return this.$store.getters.loading},originality:function(){var t=this;return t.getOriginality()},dichVuChuyenPhatKetQua:function(){return this.$store.getters.dichVuChuyenPhatKetQua}},created:function(){var t=this;t.$nextTick(function(){t.listDossierImport=[],t.thongTinChiTietHoSo={},t.dossierId=t.id,t.initData(t.id)})},beforeDestroy:function(){var t=v()('meta[name="viewport"]');t.attr("content","initial-scale=1.0, width=device-width"),"undefined"!==typeof window&&window.removeEventListener("resize",this.onResize,{passive:!0})},mounted:function(){this.onResize(),window.addEventListener("resize",this.onResize,{passive:!0})},watch:{isMobile:function(t){var s=v()('meta[name="viewport"]');t?s.attr("content",""):s.attr("content","initial-scale=1.0, width=device-width")}},methods:{uploadfileDossierImport:function(t){var s=this,e=s.$refs.thanhphanhoso.dossierTemplateItems;e=e.filter(function(t){return 1===t["partType"]}),s.$store.dispatch("loadDossierFiles",s.thongTinChiTietHoSo["dossierId"]).then(function(t){var e=[];for(var i in t)1===t[i]["dossierPartType"]&&e.push(t[i]["dossierFileId"]);s.dossierFiles=e?e.toString():"",s.progressUploadFile=!0;var o={};s.countDossierProgress=0,s.valueProgress=0,s.listDossierImport=[],s.dossierError=[],s.dossierSuccess=[],s.countDossierSuccess=0,o["dossierId"]=s.thongTinChiTietHoSo["dossierId"],o["referenceUid"]=s.thongTinChiTietHoSo["referenceUid"],o["selector"]="dossierImport",o["partTip"]={tip:"",maxSize:10,extensions:"xlsx,xls"};v()("#dossierImport")[0].files[0];s.$store.dispatch("uploadDossierFileImport",o).then(function(t){if(s.progressUploadFile=!1,s.totalDossier=t.total,t.total){var e=confirm("Bạn có chắc chắn thực hiện hành động này?");e&&(s.dialogImportDosier=!0,s.listDossierImport=t.data,console.log(t.data),setTimeout(function(){if(s.listDossierImport.length){s.loadingImportDossier=!0;var t=[];s.listDossierImport.forEach(function(e,i){setTimeout(function(){t.push(s.doCreateDossier(e,i)),t.length===s.listDossierImport.length&&d.a.all(t).then(function(t){s.loadingImportDossier=!1,0===s.dossierError.length&&(p.a.success("Import hồ sơ thành công"),setTimeout(function(){s.goBack()},1e3))}).catch(function(t){s.loadingImportDossier=!1})},1e3*i)})}},300))}else s.listDossierImport=[],p.a.error("Dữ liệu bị lỗi, vui lòng kiểm tra lại!")}).catch(function(t){s.dialogImportDosier=!1,s.progressUploadFile=!1,p.a.error("Tải file lỗi, vui lòng thử lại!")})}).catch(function(t){})},addDossierAgain:function(){var t=this;if(console.log(t.dossierSuccess),t.countDossierProgress=t.dossierSuccess.length,t.valueProgress=100*t.countDossierProgress/t.totalDossier,console.log("valueProgress++++",t.valueProgress),t.countDossierSuccess=t.dossierSuccess.length,t.dossierError.length){t.loadingImportDossier=!0;var s=[];t.dossierError.forEach(function(e,i){setTimeout(function(){s.push(t.doCreateDossier(e,i)),s.length===t.dossierError.length&&d.a.all(s).then(function(s){t.loadingImportDossier=!1,0===t.dossierError.length&&(p.a.success("Import hồ sơ thành công"),setTimeout(function(){t.goBack()},1e3))}).catch(function(s){t.loadingImportDossier=!1})},1e3*i)})}},doCreateDossier:function(t,s){var e=this;return new d.a(function(i,o){var r=e,n=e.$refs.thanhphanhoso.dossierTemplateItems,c={},d=t,h="",p="",u=r.$refs.thongtinchuhoso;r.$refs.dichvuchuyenphatketqua;if(c["serviceCode"]=r.thongTinChiTietHoSo["serviceCode"],c["govAgencyCode"]=r.thongTinChiTietHoSo["govAgencyCode"],c["dossierTemplateNo"]=r.thongTinChiTietHoSo["dossierTemplateNo"],c["originality"]=r.originality,n&&n.length){var v=n.map(function(t){return{partNo:t.partNo,partName:t.partName,fileMark:t.fileMark}});h=l()(v)}else h="";if(c["dossierMarks"]=h,u&&u["thongTinNguoiNopHoSo"]){var g=u["thongTinNguoiNopHoSo"];d=a()(d,g)}d=a()(d,r.dichVuChuyenPhatKetQua),c["dossiers"]=d?l()(d):"",c["dossierFiles"]=r.dossierFiles?r.dossierFiles:"",c["payment"]=p?l()(p):"",r.$store.dispatch("importDossier",c).then(function(t){r.countDossierProgress++,r.valueProgress+=100/r.totalDossier,r.listDossierImport[s]["flagError"]=!1,r.countDossierSuccess<r.listDossierImport.length&&r.countDossierSuccess++,r.calDossierErrorSuccess(),i(!0)}).catch(function(t){console.log(t),r.countDossierProgress++,r.valueProgress+=100/r.totalDossier,r.listDossierImport[s]["flagError"]=!0,r.calDossierErrorSuccess(),o(t)})})},calDossierErrorSuccess:function(){var t=this;t.dossierError=t.listDossierImport.filter(function(t){return t["flagError"]}),t.dossierSuccess=t.listDossierImport.filter(function(t){return!t.hasOwnProperty("flagError")||!t["flagError"]})},onResize:function(){var t=this,s=window.innerWidth<1024;t.isMobile=s},initData:function(t){var s=this;s.$store.dispatch("getDetailDossier",t).then(function(t){s.dossierId=t.dossierId,s.briefNote=t.dossierName?t.dossierName:"",t["editable"]=!1,s.thongTinChiTietHoSo=t,s.$refs.thanhphanhoso.initData(t),s.$refs.thongtinchuhoso.initData(t);var e={viaPostal:1,postalServiceCode:"VNPOST",postalAddress:"",postalCityCode:"",postalDistrictCode:"",postalWardCode:"",postalTelNo:""};s.$store.commit("setDichVuChuyenPhatKetQua",e)}).catch(function(t){console.log(t)})},pickFile:function(){var t=this,s=t.$refs.thongtinchuhoso.showValid(),e=this.$refs.dichvuchuyenphatketqua?this.$refs.dichvuchuyenphatketqua.dichVuChuyenPhatKetQua:{};if(2===e.viaPostal){if(!t.$refs.dichvuchuyenphatketqua.validDichVuChuyenPhat()||!s["validForm"])return void p.a.error("Vui lòng kiểm tra lại các thông tin bắt buộc trước khi thực hiện!")}else if(!s["validForm"])return void p.a.error("Vui lòng kiểm tra lại các thông tin bắt buộc trước khi thực hiện!");document.getElementById("dossierImport").value="",document.getElementById("dossierImport").click()},goBack:function(){var t=this,s=(t.$router.history.current.params,t.$router.history.current.query);t.$router.push({path:"/danh-sach-ho-so/0",query:s})}}},D=y,C=e("2877"),S=Object(C["a"])(D,i,o,!1,null,null,null);s["default"]=S.exports}}]);
//# sourceMappingURL=chunk-2d0a386a.js.map